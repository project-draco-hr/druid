{
  final List<List<DataSegment>> retVal=Lists.newArrayList();
  final IndexingServiceClient indexingServiceClient=new IndexingServiceClient(null,null,null){
    @Override public void mergeSegments(    List<DataSegment> segmentsToMerge){
      retVal.add(segmentsToMerge);
    }
  }
;
  final AtomicReference<MergerWhitelist> whitelistRef=new AtomicReference<MergerWhitelist>(null);
  final DruidMasterSegmentMerger merger=new DruidMasterSegmentMerger(indexingServiceClient,whitelistRef);
  final DruidMasterRuntimeParams params=DruidMasterRuntimeParams.newBuilder().withAvailableSegments(ImmutableSet.copyOf(segments)).withDynamicConfigs(new DynamicConfigs.Builder().withMergeBytesLimit(mergeBytesLimit).withMergeSegmentsLimit(mergeSegmentsLimit).build()).build();
  merger.run(params);
  return retVal;
}
