{
  final Table<String,String,Integer> segmentsInCluster=HashBasedTable.create();
  for (  MinMaxPriorityQueue<ServerHolder> serversByType : cluster.getSortedServersByTier()) {
    for (    ServerHolder serverHolder : serversByType) {
      DruidServer server=serverHolder.getServer();
      for (      DataSegment segment : server.getSegments().values()) {
        Integer numReplicants=segmentsInCluster.get(segment.getIdentifier(),server.getTier());
        if (numReplicants == null) {
          numReplicants=0;
        }
        segmentsInCluster.put(segment.getIdentifier(),server.getTier(),++numReplicants);
      }
    }
  }
  return new SegmentReplicantLookup(segmentsInCluster);
}
