{
  try {
    for (    DataSegment segment : segments) {
      log.info("Loading segment %s",segment.getIdentifier());
      try {
        serverManager.loadSegment(segment);
      }
 catch (      Exception e) {
        removeSegment(segment);
        throw new SegmentLoadingException(e,"Exception loading segment[%s]",segment.getIdentifier());
      }
      File segmentInfoCacheFile=new File(config.getSegmentInfoCacheDirectory(),segment.getIdentifier());
      if (!segmentInfoCacheFile.exists()) {
        try {
          jsonMapper.writeValue(segmentInfoCacheFile,segment);
        }
 catch (        IOException e) {
          removeSegment(segment);
          throw new SegmentLoadingException(e,"Failed to write to disk segment info cache file[%s]",segmentInfoCacheFile);
        }
      }
    }
    try {
      announcer.announceSegments(segments);
    }
 catch (    IOException e) {
      removeSegments(segments);
      throw new SegmentLoadingException(e,"Failed to announce segments[%s]",segments);
    }
  }
 catch (  SegmentLoadingException e) {
    log.makeAlert(e,"Failed to load segments for dataSource").addData("segments",segments).emit();
  }
}
