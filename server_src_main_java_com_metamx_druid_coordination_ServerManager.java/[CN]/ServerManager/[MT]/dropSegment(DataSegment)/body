{
  String dataSource=segment.getDataSource();
synchronized (lock) {
    VersionedIntervalTimeline<String,Segment> loadedIntervals=dataSources.get(dataSource);
    if (loadedIntervals == null) {
      log.info("Told to delete a queryable for a dataSource[%s] that doesn't exist.",dataSource);
      return;
    }
    PartitionChunk<Segment> removed=loadedIntervals.remove(segment.getInterval(),segment.getVersion(),segment.getShardSpec().createChunk((Segment)null));
    Segment oldQueryable=(removed == null) ? null : removed.getObject();
    if (oldQueryable != null) {
synchronized (dataSourceSizes) {
        dataSourceSizes.add(dataSource,-segment.getSize());
      }
synchronized (dataSourceCounts) {
        dataSourceCounts.add(dataSource,-1L);
      }
      try {
        oldQueryable.asQueryableIndex().close();
      }
 catch (      Exception e) {
        log.error("Unable to close queryable index %s",oldQueryable.getIdentifier());
      }
    }
 else {
      log.info("Told to delete a queryable on dataSource[%s] for interval[%s] and version [%s] that I don't have.",dataSource,segment.getInterval(),segment.getVersion());
    }
  }
  segmentLoader.cleanup(segment);
}
