{
  EasyMock.replay(yp);
  List<DataSegment> segments=Lists.newArrayList(makeSegment("test","1",new Interval("P1d/2011-04-01")),makeSegment("test","1",new Interval("P1d/2011-04-02")),makeSegment("test","2",new Interval("P1d/2011-04-02")),makeSegment("test","1",new Interval("P1d/2011-04-03")),makeSegment("test","1",new Interval("P1d/2011-04-04")),makeSegment("test","1",new Interval("P1d/2011-04-05")),makeSegment("test","2",new Interval("PT1h/2011-04-04T01")),makeSegment("test","2",new Interval("PT1h/2011-04-04T02")),makeSegment("test","2",new Interval("PT1h/2011-04-04T03")),makeSegment("test","2",new Interval("PT1h/2011-04-04T05")),makeSegment("test","2",new Interval("PT1h/2011-04-04T06")),makeSegment("test2","1",new Interval("P1d/2011-04-01")),makeSegment("test2","1",new Interval("P1d/2011-04-02")));
  Collections.sort(segments);
  for (  DataSegment segment : segments) {
    writeSegmentToCache(segment);
  }
  checkCache(segments);
  Assert.assertTrue(serverManager.getDataSourceCounts().isEmpty());
  zkCoordinator.start();
  Assert.assertTrue(!serverManager.getDataSourceCounts().isEmpty());
  zkCoordinator.stop();
  for (  DataSegment segment : segments) {
    deleteSegmentFromCache(segment);
  }
  Assert.assertEquals(0,cacheDir.listFiles().length);
  Assert.assertTrue(cacheDir.delete());
}
