{
  final Pair<String,ServerDiscoverySelector> selected=hostSelector.select(query);
  final String serviceName=selected.lhs;
  final ServerDiscoverySelector selector=selected.rhs;
  Server server=selector.pick();
  if (server == null) {
    log.error("WTF?! No server found for serviceName[%s]. Using backup",serviceName);
    server=serverBackup.get(serviceName);
    if (server == null) {
      log.error("WTF?! No backup found for serviceName[%s]. Using default[%s]",serviceName,hostSelector.getDefaultServiceName());
      server=serverBackup.get(hostSelector.getDefaultServiceName());
    }
  }
  if (server != null) {
    serverBackup.put(serviceName,server);
  }
  return server;
}
