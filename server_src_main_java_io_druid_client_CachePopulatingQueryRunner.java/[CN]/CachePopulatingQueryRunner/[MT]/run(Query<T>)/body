{
  final CacheStrategy strategy=toolChest.getCacheStrategy(query);
  final boolean populateCache=Boolean.parseBoolean(query.getContextValue("populateCache","true")) && strategy != null && cache.getCacheConfig().isPopulateCache();
  Sequence<T> results=base.run(query);
  if (populateCache) {
    Cache.NamedKey key=CacheUtil.computeSegmentCacheKey(segmentIdentifier,segmentDescriptor,strategy.computeCacheKey(query));
    CacheUtil.populate(cache,mapper,key,Sequences.toList(Sequences.map(results,strategy.prepareForCache()),new ArrayList()));
  }
  return results;
}
