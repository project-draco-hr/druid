{
  final DataPusher descriptorPusher=(DataPusher)RetryProxy.create(DataPusher.class,new DataPusher(){
    @Override public void push() throws IOException {
      try {
        progressable.progress();
        if (outputFS.exists(descriptorPath)) {
          if (!fileContext.delete(descriptorPath,false)) {
            throw new IOException(String.format("Failed to delete descriptor at [%s]",descriptorPath));
          }
        }
        try (final OutputStream descriptorOut=fileContext.create(descriptorPath,EnumSet.of(CreateFlag.OVERWRITE,CreateFlag.CREATE),Options.CreateOpts.bufferSize(256 * 1024),Options.CreateOpts.createParent())){
          HadoopDruidIndexerConfig.jsonMapper.writeValue(descriptorOut,segment);
          descriptorOut.flush();
        }
       }
 catch (      RuntimeException|IOException ex) {
        log.info(ex,"Error in retry loop");
        throw ex;
      }
    }
  }
,RetryPolicies.retryUpToMaximumCountWithFixedSleep(NUM_RETRIES,SECONDS_BETWEEN_RETRIES,TimeUnit.SECONDS));
  descriptorPusher.push();
}
