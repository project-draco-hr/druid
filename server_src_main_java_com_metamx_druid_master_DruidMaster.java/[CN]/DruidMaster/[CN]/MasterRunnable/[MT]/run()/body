{
  try {
synchronized (lock) {
      Map<String,String> currLeader=clusterInfo.lookupCurrentLeader();
      if (currLeader == null || !config.getHost().equals(currLeader.get("host"))) {
        log.info("I thought I was the master, but really [%s] is.  Phooey.",currLeader);
        stopBeingMaster();
        return;
      }
    }
    List<Boolean> allStarted=Arrays.asList(databaseSegmentManager.isStarted(),serverInventoryManager.isStarted());
    for (    Boolean aBoolean : allStarted) {
      if (!aBoolean) {
        log.error("InventoryManagers not started[%s]",allStarted);
        stopBeingMaster();
        return;
      }
    }
    DruidMasterRuntimeParams params=DruidMasterRuntimeParams.newBuilder().withStartTime(startTime).withDatasources(databaseSegmentManager.getInventory()).withMillisToWaitBeforeDeleting(config.getMillisToWaitBeforeDeleting()).withEmitter(emitter).withMergeBytesLimit(config.getMergeBytesLimit()).withMergeSegmentsLimit(config.getMergeSegmentsLimit()).withMaxSegmentsToMove(config.getMaxSegmentsToMove()).build();
    for (    DruidMasterHelper helper : helpers) {
      params=helper.run(params);
    }
  }
 catch (  Exception e) {
    log.makeAlert(e,"Caught exception, ignoring so that schedule keeps going.").emit();
  }
}
