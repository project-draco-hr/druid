{
  final Optional<Interval> timeBucket=schema.getDataSchema().getGranularitySpec().bucketInterval(new DateTime(inputRow.getTimestampFromEpoch()));
  if (!timeBucket.isPresent()) {
    return Optional.absent();
  }
  final ShardSpec actualSpec=shardSpecLookups.get(timeBucket.get().getStart()).getShardSpec(inputRow);
  final HadoopyShardSpec hadoopyShardSpec=hadoopShardSpecLookup.get(actualSpec);
  return Optional.of(new Bucket(hadoopyShardSpec.getShardNum(),timeBucket.get().getStart(),actualSpec.getPartitionNum()));
}
