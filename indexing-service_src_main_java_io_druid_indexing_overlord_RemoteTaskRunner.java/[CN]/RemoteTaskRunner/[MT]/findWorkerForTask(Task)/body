{
  TreeSet<ZkWorker> sortedWorkers=Sets.newTreeSet(new Comparator<ZkWorker>(){
    @Override public int compare(    ZkWorker zkWorker,    ZkWorker zkWorker2){
      int retVal=Ints.compare(zkWorker2.getCurrCapacityUsed(),zkWorker.getCurrCapacityUsed());
      if (retVal == 0) {
        retVal=zkWorker.getWorker().getHost().compareTo(zkWorker2.getWorker().getHost());
      }
      return retVal;
    }
  }
);
  sortedWorkers.addAll(zkWorkers.values());
  final String minWorkerVer=config.getMinWorkerVersion();
  for (  ZkWorker zkWorker : sortedWorkers) {
    if (zkWorker.canRunTask(task) && zkWorker.isValidVersion(minWorkerVer)) {
      return zkWorker;
    }
  }
  log.debug("Worker nodes %s do not have capacity to run any more tasks!",zkWorkers.values());
  return null;
}
