{
  log.info("Setting version to: %s",context.getVersion());
  config.setVersion(context.getVersion());
  if (toolbox.getSegmentPusher() instanceof S3SegmentPusher) {
    S3SegmentPusher segmentPusher=(S3SegmentPusher)toolbox.getSegmentPusher();
    String s3Path=String.format("s3n%s/%s/%s",segmentPusher.getConfig().getBucket(),segmentPusher.getConfig().getBaseKey(),getDataSource());
    log.info("Setting segment output path to: %s",s3Path);
    config.setSegmentOutputDir(s3Path);
  }
 else {
    throw new IllegalStateException("Sorry, we only work with S3SegmentPushers! Bummer!");
  }
  HadoopDruidIndexerJob job=new HadoopDruidIndexerJob(config);
  log.debug("Starting a hadoop index generator job...");
  if (job.run()) {
    List<DataSegment> publishedSegments=job.getPublishedSegments();
    return TaskStatus.success(getId(),ImmutableList.copyOf(publishedSegments));
  }
 else {
    return TaskStatus.failure(getId());
  }
}
