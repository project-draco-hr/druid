{
  final String service=serviceName(key);
  log.info("Registering EventReceiver: %s",key);
  if (receivers.putIfAbsent(key,receiver) != null) {
    throw new ISE("Receiver already registered for key: %s",key);
  }
  try {
    serviceAnnouncer.announce(service);
  }
 catch (  Exception e) {
    log.warn(e,"Failed to register service: %s",service);
    receivers.remove(key,receiver);
  }
}
