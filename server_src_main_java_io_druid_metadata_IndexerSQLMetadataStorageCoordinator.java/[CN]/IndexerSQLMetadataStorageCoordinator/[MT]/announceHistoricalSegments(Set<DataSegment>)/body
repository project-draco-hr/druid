{
  return connector.getDBI().inTransaction(new TransactionCallback<Set<DataSegment>>(){
    @Override public Set<DataSegment> inTransaction(    Handle handle,    TransactionStatus transactionStatus) throws IOException {
      final Set<DataSegment> inserted=Sets.newHashSet();
      for (      final DataSegment segment : segments) {
        if (announceHistoricalSegment(handle,segment)) {
          inserted.add(segment);
        }
      }
      return ImmutableSet.copyOf(inserted);
    }
  }
);
}
