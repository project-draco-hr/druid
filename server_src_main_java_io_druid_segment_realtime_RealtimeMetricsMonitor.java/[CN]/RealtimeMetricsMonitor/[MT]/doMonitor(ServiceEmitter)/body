{
  for (  FireDepartment fireDepartment : fireDepartments) {
    FireDepartmentMetrics metrics=fireDepartment.getMetrics().snapshot();
    FireDepartmentMetrics previous=previousValues.get(fireDepartment);
    if (previous == null) {
      previous=new FireDepartmentMetrics();
    }
    final ServiceMetricEvent.Builder builder=new ServiceMetricEvent.Builder().setUser2(fireDepartment.getDataSchema().getDataSource());
    emitter.emit(builder.build("events/thrownAway",metrics.thrownAway() - previous.thrownAway()));
    emitter.emit(builder.build("events/unparseable",metrics.unparseable() - previous.unparseable()));
    emitter.emit(builder.build("events/processed",metrics.processed() - previous.processed()));
    emitter.emit(builder.build("rows/output",metrics.rowOutput() - previous.rowOutput()));
    emitter.emit(builder.build("persists/num",metrics.numPersists() - previous.numPersists()));
    emitter.emit(builder.build("persists/time",metrics.persistTimeMillis() - previous.persistTimeMillis()));
    emitter.emit(builder.build("persists/backPressure",metrics.persistBackPressureMillis() - previous.persistBackPressureMillis()));
    previousValues.put(fireDepartment,metrics);
  }
  return true;
}
