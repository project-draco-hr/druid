{
  final ServiceEmitter emitter=EasyMock.createMock(ServiceEmitter.class);
  EmittingLogger.registerEmitter(emitter);
  queryRunnerFactoryConglomerate=EasyMock.createStrictMock(QueryRunnerFactoryConglomerate.class);
  serverView=EasyMock.createStrictMock(FilteredServerView.class);
  monitorScheduler=EasyMock.createStrictMock(MonitorScheduler.class);
  publishCountDown=new CountDownLatch(1);
  announcedSinks=0;
  pushedSegments=0;
  tmp=Files.createTempDir();
  final TaskQueueConfig tqc=new DefaultObjectMapper().readValue("{\"startDelay\":\"PT0S\", \"restartDelay\":\"PT1S\"}",TaskQueueConfig.class);
  indexSpec=new IndexSpec();
  ts=new HeapMemoryTaskStorage(new TaskStorageConfig(null){
  }
);
  tsqa=new TaskStorageQueryAdapter(ts);
  tl=new TaskLockbox(ts);
  mdc=newMockMDC();
  tac=new LocalTaskActionClientFactory(ts,new TaskActionToolbox(tl,mdc,newMockEmitter()));
  tb=new TaskToolboxFactory(new TaskConfig(tmp.toString(),null,null,50000,null),tac,newMockEmitter(),new DataSegmentPusher(){
    @Override public String getPathForHadoop(    String dataSource){
      throw new UnsupportedOperationException();
    }
    @Override public DataSegment push(    File file,    DataSegment segment) throws IOException {
      pushedSegments++;
      return segment;
    }
  }
,new DataSegmentKiller(){
    @Override public void kill(    DataSegment segments) throws SegmentLoadingException {
    }
  }
,new DataSegmentMover(){
    @Override public DataSegment move(    DataSegment dataSegment,    Map<String,Object> targetLoadSpec) throws SegmentLoadingException {
      return dataSegment;
    }
  }
,new DataSegmentArchiver(){
    @Override public DataSegment archive(    DataSegment segment) throws SegmentLoadingException {
      return segment;
    }
    @Override public DataSegment restore(    DataSegment segment) throws SegmentLoadingException {
      return segment;
    }
  }
,new DataSegmentAnnouncer(){
    @Override public void announceSegment(    DataSegment segment) throws IOException {
      announcedSinks++;
    }
    @Override public void unannounceSegment(    DataSegment segment) throws IOException {
    }
    @Override public void announceSegments(    Iterable<DataSegment> segments) throws IOException {
    }
    @Override public void unannounceSegments(    Iterable<DataSegment> segments) throws IOException {
    }
  }
,serverView,queryRunnerFactoryConglomerate,null,monitorScheduler,new SegmentLoaderFactory(new SegmentLoaderLocalCacheManager(null,new SegmentLoaderConfig(){
    @Override public List<StorageLocationConfig> getLocations(){
      return Lists.newArrayList();
    }
  }
,new DefaultObjectMapper())),new DefaultObjectMapper());
  tr=new ThreadPoolTaskRunner(tb,null);
  tq=new TaskQueue(tqc,ts,tr,tac,tl,emitter);
  tq.start();
}
