{
  EmittingLogger.registerEmitter(EasyMock.createMock(ServiceEmitter.class));
  tmp=Files.createTempDir();
  ts=new HeapMemoryTaskStorage();
  tl=new TaskLockbox(ts);
  tq=new TaskQueue(ts,tl);
  mdc=newMockMDC();
  tac=new LocalTaskActionClientFactory(ts,new TaskActionToolbox(tq,tl,mdc,newMockEmitter()));
  tb=new TaskToolboxFactory(new TaskConfig(tmp.toString(),null,null,50000),tac,newMockEmitter(),new DataSegmentPusher(){
    @Override public String getPathForHadoop(    String dataSource){
      throw new UnsupportedOperationException();
    }
    @Override public DataSegment push(    File file,    DataSegment segment) throws IOException {
      return segment;
    }
  }
,new DataSegmentKiller(){
    @Override public void kill(    DataSegment segments) throws SegmentLoadingException {
    }
  }
,null,null,null,null,null,new SegmentLoaderFactory(new OmniSegmentLoader(ImmutableMap.<String,DataSegmentPuller>of("local",new LocalDataSegmentPuller()),null,new SegmentLoaderConfig(){
    @Override public List<StorageLocationConfig> getLocations(){
      return Lists.newArrayList();
    }
  }
)),new DefaultObjectMapper());
  tr=new ThreadPoolTaskRunner(tb);
  tc=new TaskConsumer(tq,tr,tac,newMockEmitter());
  tsqa=new TaskStorageQueryAdapter(ts);
  tq.start();
  tc.start();
}
