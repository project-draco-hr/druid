{
  Map<String,Integer> task=ImmutableMap.of("taskId",1234);
  Map<String,Integer> taskStatus=ImmutableMap.of("count",42);
  Map<String,Integer> taskStatus2=ImmutableMap.of("count",42,"temp",1);
  final String taskId="1234";
  handler.insert(taskId,new DateTime("2014-01-02T00:00:00.123"),"testDataSource",task,true,null);
  Assert.assertEquals(Optional.of(task),handler.getTask(taskId));
  Assert.assertEquals(Optional.absent(),handler.getTaskStatus(taskId));
  Assert.assertTrue(handler.setStatus(taskId,true,taskStatus));
  Assert.assertEquals(ImmutableList.of(Pair.of(task,taskStatus)),handler.getActiveTasksWithStatus());
  Assert.assertTrue(handler.setStatus(taskId,true,taskStatus2));
  Assert.assertEquals(ImmutableList.of(Pair.of(task,taskStatus2)),handler.getActiveTasksWithStatus());
  Assert.assertEquals(ImmutableList.of(),handler.getRecentlyFinishedTaskStatuses(new DateTime("2014-01-01")));
  Assert.assertTrue(handler.setStatus(taskId,false,taskStatus));
  Assert.assertEquals(Optional.of(taskStatus),handler.getTaskStatus(taskId));
  Assert.assertFalse(handler.setStatus(taskId,false,taskStatus2));
  Assert.assertEquals(Optional.of(taskStatus),handler.getTaskStatus(taskId));
  Assert.assertEquals(Optional.of(task),handler.getTask(taskId));
  Assert.assertEquals(ImmutableList.of(),handler.getRecentlyFinishedTaskStatuses(new DateTime("2014-01-03")));
  Assert.assertEquals(ImmutableList.of(taskStatus),handler.getRecentlyFinishedTaskStatuses(new DateTime("2014-01-01")));
}
