{
synchronized (lock) {
    String dataSourceName=segment.getDataSource();
    DruidDataSource dataSource=dataSources.get(dataSourceName);
    if (dataSource == null) {
      dataSource=new DruidDataSource(dataSourceName,ImmutableMap.of("client","side"));
      dataSources.put(dataSourceName,dataSource);
    }
    dataSource.addSegment(segmentId,segment);
    if (!segments.containsKey(segmentId)) {
      segments.put(segmentId,segment);
      currSize+=segment.getSize();
    }
  }
  return this;
}
