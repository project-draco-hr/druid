{
synchronized (lock) {
    DataSegment segment=segments.get(segmentName);
    if (segment == null) {
      log.warn("Asked to remove data segment that doesn't exist!? server[%s], segment[%s]",name,segmentName);
      return this;
    }
    DruidDataSource dataSource=dataSources.get(segment.getDataSource());
    if (dataSource == null) {
      log.warn("Asked to remove data segment from dataSource[%s] that doesn't exist, but the segment[%s] exists!?!?!?! wtf?  server[%s]",segment.getDataSource(),segmentName,name);
      return this;
    }
    dataSource.removePartition(segmentName);
    segments.remove(segmentName);
    if (dataSource.isEmpty()) {
      dataSources.remove(dataSource.getName());
    }
    currSize-=segment.getSize();
  }
  return this;
}
