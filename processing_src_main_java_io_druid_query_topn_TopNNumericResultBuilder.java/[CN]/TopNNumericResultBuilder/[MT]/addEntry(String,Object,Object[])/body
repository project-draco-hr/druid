{
  final Map<String,Object> metricValues=new LinkedHashMap<>(metricVals.length + postAggs.size());
  metricValues.put(dimSpec.getOutputName(),dimName);
  Iterator<AggregatorFactory> aggFactoryIter=aggFactories.iterator();
  for (  Object metricVal : metricVals) {
    metricValues.put(aggFactoryIter.next().getName(),metricVal);
  }
  for (  PostAggregator postAgg : postAggs) {
    metricValues.put(postAgg.getName(),postAgg.compute(metricValues));
  }
  Object topNMetricVal=metricValues.get(metricName);
  if (shouldAdd(topNMetricVal)) {
    DimValHolder dimValHolder=new DimValHolder.Builder().withTopNMetricVal(topNMetricVal).withDirName(dimName).withDimValIndex(dimValIndex).withMetricValues(metricValues).build();
    pQueue.add(dimValHolder);
  }
  if (this.pQueue.size() > this.threshold) {
    pQueue.poll();
  }
  return this;
}
