{
  if (namespaces == null) {
    namespaces=Maps.newHashMap();
  }
  this.namespaces=namespaces;
  this.geoIpDatabase=geoIpDatabase;
  File geoDb;
  if (geoIpDatabase != null) {
    geoDb=new File(geoIpDatabase);
  }
 else {
    try {
      String tmpDir=System.getProperty("java.io.tmpdir");
      geoDb=new File(tmpDir,this.getClass().getCanonicalName() + ".GeoLite2-City.mmdb");
      if (!geoDb.exists()) {
        log.info("Downloading geo ip database to [%s]. This may take a few minutes.",geoDb);
        File tmpFile=File.createTempFile("druid","geo");
        FileUtils.copyInputStreamToFile(new GZIPInputStream(new URL("http://geolite.maxmind.com/download/geoip/database/GeoLite2-City.mmdb.gz").openStream()),tmpFile);
        if (!tmpFile.renameTo(geoDb)) {
          throw new RuntimeException("Unable to move geo file!");
        }
      }
 else {
        log.info("Using geo ip database at [%s].",geoDb);
      }
    }
 catch (    IOException e) {
      throw new RuntimeException("Unable to download geo ip database [%s]",e);
    }
  }
  try {
    geoLookup=new DatabaseReader(geoDb);
  }
 catch (  IOException e) {
    throw new RuntimeException("Unable to open geo ip lookup database",e);
  }
}
