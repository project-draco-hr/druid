{
  final String storageDir=HdfsDataSegmentPusherUtil.getStorageDir(segment);
  Path outFile=new Path(String.format("%s/%s/index.zip",config.getStorageDirectory(),storageDir));
  FileSystem fs=outFile.getFileSystem(hadoopConfig);
  fs.mkdirs(outFile.getParent());
  log.info("Compressing files from[%s] to [%s]",inDir,outFile);
  FSDataOutputStream out=null;
  long size;
  try {
    out=fs.create(outFile);
    size=CompressionUtils.zip(inDir,out);
    out.close();
  }
  finally {
    Closeables.closeQuietly(out);
  }
  return createDescriptorFile(segment.withLoadSpec(makeLoadSpec(outFile)).withSize(size).withBinaryVersion(IndexIO.CURRENT_VERSION_ID),outFile.getParent(),fs);
}
