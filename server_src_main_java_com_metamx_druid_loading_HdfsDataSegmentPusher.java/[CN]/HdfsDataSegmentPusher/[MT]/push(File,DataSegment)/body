{
  final String storageDir=DataSegmentPusherUtil.getStorageDir(segment);
  Path outFile=config.getStorageDirectory().suffix(String.format("/%s/index.zip",storageDir));
  FileSystem fs=outFile.getFileSystem(hadoopConfig);
  fs.mkdirs(outFile.getParent());
  log.info("Compressing files from[%s] to [%s]",inDir,outFile);
  FSDataOutputStream out=null;
  long size;
  try {
    out=fs.create(outFile);
    size=CompressionUtils.zip(inDir,out);
    out.close();
  }
  finally {
    Closeables.closeQuietly(out);
  }
  return createDescriptorFile(segment.withLoadSpec(makeLoadSpec(outFile)).withSize(size).withBinaryVersion(IndexIO.CURRENT_VERSION_ID),outFile.getParent(),fs);
}
