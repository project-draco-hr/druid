{
  EmittingLogger.registerEmitter(EasyMock.createMock(ServiceEmitter.class));
  tmp=Files.createTempDir();
  ts=new HeapMemoryTaskStorage();
  tl=new TaskLockbox(ts);
  tq=new TaskQueue(ts,tl);
  mdc=newMockMDC();
  tb=new TaskToolboxFactory(new TaskConfig(){
    @Override public File getBaseTaskDir(){
      return tmp;
    }
    @Override public int getDefaultRowFlushBoundary(){
      return 50000;
    }
    @Override public String getHadoopWorkingPath(){
      return null;
    }
  }
,new LocalTaskActionClientFactory(ts,new TaskActionToolbox(tq,tl,mdc,newMockEmitter())),newMockEmitter(),null,new DataSegmentPusher(){
    @Override public DataSegment push(    File file,    DataSegment segment) throws IOException {
      return segment;
    }
  }
,new SegmentKiller(){
    @Override public void kill(    Collection<DataSegment> segments) throws ServiceException {
    }
  }
,new DefaultObjectMapper());
  tr=new LocalTaskRunner(tb,Executors.newSingleThreadExecutor());
  tc=new TaskConsumer(tq,tr,tb,newMockEmitter());
  tsqa=new TaskStorageQueryAdapter(ts);
  tq.start();
  tc.start();
}
