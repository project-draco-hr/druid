{
  S3Coords s3Coords=new S3Coords(segment);
  log.info("Loading index at path[%s]",s3Coords);
  if (!isObjectInBucket(s3Coords)) {
    throw new StorageAdapterLoadingException("IndexFile[%s] does not exist.",s3Coords);
  }
  long currTime=System.currentTimeMillis();
  File tmpFile=null;
  S3Object s3Obj=null;
  try {
    s3Obj=s3Client.getObject(new S3Bucket(s3Coords.bucket),s3Coords.path);
    tmpFile=File.createTempFile(s3Coords.bucket,new DateTime().toString() + s3Coords.path.replace('/','_'));
    log.info("Downloading file[%s] to local tmpFile[%s] for segment[%s]",s3Coords,tmpFile,segment);
    StreamUtils.copyToFileAndClose(s3Obj.getDataInputStream(),tmpFile,DEFAULT_TIMEOUT);
    final long downloadEndTime=System.currentTimeMillis();
    log.info("Download of file[%s] completed in %,d millis",tmpFile,downloadEndTime - currTime);
    return tmpFile;
  }
 catch (  Exception e) {
    if (tmpFile != null && tmpFile.exists()) {
      tmpFile.delete();
    }
    throw new StorageAdapterLoadingException(e,e.getMessage());
  }
 finally {
    S3Utils.closeStreamsQuietly(s3Obj);
  }
}
