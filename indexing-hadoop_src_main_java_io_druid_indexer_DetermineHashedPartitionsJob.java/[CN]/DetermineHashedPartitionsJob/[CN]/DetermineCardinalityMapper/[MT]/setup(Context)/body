{
  super.setup(context);
  rollupGranularity=getConfig().getRollupSpec().getRollupGranularity();
  config=HadoopDruidIndexerConfigBuilder.fromConfiguration(context.getConfiguration());
  if (config.getSegmentGranularIntervals().isEmpty()) {
    determineIntervals=true;
    hyperLogLogs=Maps.newHashMap();
  }
 else {
    determineIntervals=false;
    final ImmutableMap.Builder<Interval,HyperLogLog> builder=ImmutableMap.builder();
    for (    final Interval bucketInterval : config.getGranularitySpec().bucketIntervals()) {
      builder.put(bucketInterval,new HyperLogLog(HYPER_LOG_LOG_BIT_SIZE));
    }
    hyperLogLogs=builder.build();
  }
}
