{
  IncrementalIndex newIndex=new IncrementalIndex(new IncrementalIndexSchema.Builder().withMinTimestamp(minTimestamp).withQueryGranularity(schema.getGranularitySpec().getQueryGranularity()).withDimensionsSpec(schema.getParser()).withMetrics(schema.getAggregators()).build(),new OffheapBufferPool(config.getBufferSize()));
  FireHydrant old;
  if (currHydrant == null) {
    old=currHydrant;
    currHydrant=new FireHydrant(newIndex,hydrants.size(),getSegment().getIdentifier());
    hydrants.add(currHydrant);
  }
 else {
synchronized (currHydrant) {
      old=currHydrant;
      currHydrant=new FireHydrant(newIndex,hydrants.size(),getSegment().getIdentifier());
      hydrants.add(currHydrant);
    }
  }
  return old;
}
