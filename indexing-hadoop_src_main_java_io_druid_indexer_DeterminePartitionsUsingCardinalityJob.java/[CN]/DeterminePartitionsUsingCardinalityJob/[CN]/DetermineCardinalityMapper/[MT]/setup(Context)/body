{
  super.setup(context);
  rollupGranularity=getConfig().getRollupSpec().getRollupGranularity();
  hashFunction=Hashing.murmur3_128();
  config=HadoopDruidIndexerConfigBuilder.fromConfiguration(context.getConfiguration());
  final ImmutableMap.Builder<Interval,HyperLogLog> builder=ImmutableMap.builder();
  for (  final Interval bucketInterval : config.getGranularitySpec().bucketIntervals()) {
    builder.put(bucketInterval,new HyperLogLog(20));
  }
  hyperLogLogs=builder.build();
}
