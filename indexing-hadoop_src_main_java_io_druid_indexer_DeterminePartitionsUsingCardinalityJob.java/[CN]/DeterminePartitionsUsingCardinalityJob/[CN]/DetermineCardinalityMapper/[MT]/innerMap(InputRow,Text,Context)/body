{
  final Map<String,Set<String>> dims=Maps.newTreeMap();
  for (  final String dim : inputRow.getDimensions()) {
    final Set<String> dimValues=ImmutableSortedSet.copyOf(inputRow.getDimension(dim));
    if (dimValues.size() > 0) {
      dims.put(dim,dimValues);
    }
  }
  final List<Object> groupKey=ImmutableList.of(rollupGranularity.truncate(inputRow.getTimestampFromEpoch()),dims);
  final Optional<Interval> maybeInterval=config.getGranularitySpec().bucketInterval(new DateTime(inputRow.getTimestampFromEpoch()));
  if (!maybeInterval.isPresent()) {
    throw new ISE("WTF?! No bucket found for timestamp: %s",inputRow.getTimestampFromEpoch());
  }
  hyperLogLogs.get(maybeInterval.get()).offerHashed(hashFunction.hashBytes(HadoopDruidIndexerConfig.jsonMapper.writeValueAsBytes(groupKey)).asLong());
}
