{
  this.dataSource=dataSource;
  final Set<String> dimensionExclusions=Sets.newHashSet();
  if (parser != null && parser.getParseSpec() != null && parser.getParseSpec().getTimestampSpec() != null) {
    dimensionExclusions.add(parser.getParseSpec().getTimestampSpec().getTimestampColumn());
    for (    AggregatorFactory aggregator : aggregators) {
      dimensionExclusions.add(aggregator.getName());
    }
  }
  if (parser != null && parser.getParseSpec() != null && parser.getParseSpec().getDimensionsSpec() != null) {
    this.parser=parser.withParseSpec(parser.getParseSpec().withDimensionsSpec(parser.getParseSpec().getDimensionsSpec().withDimensionExclusions(dimensionExclusions)));
  }
 else {
    this.parser=parser;
  }
  this.aggregators=aggregators;
  this.granularitySpec=granularitySpec == null ? new UniformGranularitySpec(null,null,null,null) : granularitySpec;
}
