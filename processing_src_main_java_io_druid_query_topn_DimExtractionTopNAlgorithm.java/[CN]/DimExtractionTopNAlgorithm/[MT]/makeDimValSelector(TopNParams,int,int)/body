{
  final AggregatorArrayProvider provider=new AggregatorArrayProvider(params.getDimSelector(),query,params.getCardinality());
  if (query.getDimensionSpec().canTransformValues()) {
    return provider.build();
  }
  return query.getTopNMetricSpec().configureOptimizer(provider).build();
}
