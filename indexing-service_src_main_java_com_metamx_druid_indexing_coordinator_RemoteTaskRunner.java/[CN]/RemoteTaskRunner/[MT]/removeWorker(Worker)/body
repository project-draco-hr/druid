{
  log.info("Kaboom! Worker[%s] removed!",worker.getHost());
  ZkWorker zkWorker=zkWorkers.get(worker.getHost());
  if (zkWorker != null) {
    try {
      List<String> tasksToFail=Lists.newArrayList(cf.getChildren().forPath(JOINER.join(config.getIndexerTaskPath(),worker.getHost())));
      tasksToFail.addAll(zkWorker.getRunningTaskIds());
      for (      String assignedTask : tasksToFail) {
        RemoteTaskRunnerWorkItem taskRunnerWorkItem=runningTasks.remove(assignedTask);
        if (taskRunnerWorkItem != null) {
          String taskPath=JOINER.join(config.getIndexerTaskPath(),worker.getHost(),assignedTask);
          if (cf.checkExists().forPath(taskPath) != null) {
            cf.delete().guaranteed().forPath(taskPath);
          }
          log.info("Failing task %s",assignedTask);
          taskRunnerWorkItem.setResult(TaskStatus.failure(taskRunnerWorkItem.getTask().getId()));
        }
 else {
          log.warn("RemoteTaskRunner has no knowledge of task %s",assignedTask);
        }
      }
    }
 catch (    Exception e) {
      throw Throwables.propagate(e);
    }
 finally {
      try {
        zkWorker.close();
      }
 catch (      Exception e) {
        log.error(e,"Exception closing worker %s!",worker.getHost());
      }
      zkWorkers.remove(worker.getHost());
    }
  }
}
