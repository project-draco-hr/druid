{
  final Task task=taskRunnerWorkItem.getTask();
  log.info("Coordinator asking Worker[%s] to add task[%s]",theWorker.getHost(),task.getId());
  byte[] rawBytes=jsonMapper.writeValueAsBytes(task);
  if (rawBytes.length > config.getMaxNumBytes()) {
    throw new ISE("Length of raw bytes for task too large[%,d > %,d]",rawBytes.length,config.getMaxNumBytes());
  }
  String taskPath=JOINER.join(config.getIndexerTaskPath(),theWorker.getHost(),task.getId());
  if (cf.checkExists().forPath(taskPath) == null) {
    cf.create().withMode(CreateMode.EPHEMERAL).forPath(taskPath,rawBytes);
  }
  RemoteTaskRunnerWorkItem workItem=pendingTasks.remove(task.getId());
  if (workItem == null) {
    log.makeAlert("WTF?! Got a null work item from pending tasks?! How can this be?!").addData("taskId",task.getId()).emit();
    return;
  }
  RemoteTaskRunnerWorkItem newWorkItem=workItem.withWorker(theWorker);
  runningTasks.put(task.getId(),newWorkItem);
  log.info("Task %s switched from pending to running (on [%s])",task.getId(),newWorkItem.getWorker().getHost());
  Stopwatch timeoutStopwatch=new Stopwatch();
  timeoutStopwatch.start();
synchronized (statusLock) {
    while (!isWorkerRunningTask(theWorker,task)) {
      statusLock.wait(config.getTaskAssignmentTimeoutDuration().getMillis());
      if (timeoutStopwatch.elapsed(TimeUnit.MILLISECONDS) >= config.getTaskAssignmentTimeoutDuration().getMillis()) {
        log.error("Something went wrong! %s never ran task %s after %s!",theWorker.getHost(),task.getId(),config.getTaskAssignmentTimeoutDuration());
        taskRunnerWorkItem.setResult(TaskStatus.failure(taskRunnerWorkItem.getTask().getId()));
        break;
      }
    }
  }
}
