{
  RemoteTaskRunnerWorkItem runningTask=runningTasks.get(task.getId());
  if (runningTask != null) {
    ZkWorker zkWorker=findWorkerRunningTask(task.getId());
    if (zkWorker == null) {
      log.error("Got task %s that is running but no worker is actually running it?",task.getId());
    }
 else {
      log.info("Task[%s] already running on %s.",task.getId(),zkWorker.getWorker().getHost());
      TaskStatus status=zkWorker.getRunningTasks().get(task.getId());
      if (status.isComplete()) {
        taskComplete(runningTask,zkWorker,task.getId(),status);
      }
    }
    return runningTask.getResult();
  }
  RemoteTaskRunnerWorkItem pendingTask=pendingTasks.get(task.getId());
  if (pendingTask != null) {
    log.info("Assigned a task[%s] that is already pending, not doing anything",task.getId());
    return pendingTask.getResult();
  }
  RemoteTaskRunnerWorkItem taskRunnerWorkItem=new RemoteTaskRunnerWorkItem(task,SettableFuture.<TaskStatus>create());
  addPendingTask(taskRunnerWorkItem);
  return taskRunnerWorkItem.getResult();
}
