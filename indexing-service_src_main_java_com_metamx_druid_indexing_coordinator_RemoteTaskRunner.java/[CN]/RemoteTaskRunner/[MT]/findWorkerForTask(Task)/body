{
  TreeSet<ZkWorker> sortedWorkers=Sets.newTreeSet(new Comparator<ZkWorker>(){
    @Override public int compare(    ZkWorker zkWorker,    ZkWorker zkWorker2){
      return -Ints.compare(zkWorker.getCurrCapacity(),zkWorker2.getCurrCapacity());
    }
  }
);
  sortedWorkers.addAll(zkWorkers.values());
  final String configMinWorkerVer=workerSetupData.get().getMinVersion();
  final String minWorkerVer=configMinWorkerVer == null ? config.getWorkerVersion() : configMinWorkerVer;
  for (  ZkWorker zkWorker : sortedWorkers) {
    if (zkWorker.canRunTask(task) && zkWorker.getWorker().getVersion().compareTo(minWorkerVer) >= 0) {
      return zkWorker;
    }
  }
  log.debug("Worker nodes %s do not have capacity to run any more tasks!",zkWorkers.values());
  return null;
}
