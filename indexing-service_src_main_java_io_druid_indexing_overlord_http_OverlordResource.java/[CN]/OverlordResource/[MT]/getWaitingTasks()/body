{
  return workItemsResponse(new Function<TaskRunner,Collection<? extends TaskRunnerWorkItem>>(){
    @Override public Collection<? extends TaskRunnerWorkItem> apply(    TaskRunner taskRunner){
      final List<Task> activeTasks=taskStorageQueryAdapter.getActiveTasks();
      final Set<String> runnersKnownTasks=Sets.newHashSet(Iterables.transform(taskRunner.getKnownTasks(),new Function<TaskRunnerWorkItem,String>(){
        @Override public String apply(        final TaskRunnerWorkItem workItem){
          return workItem.getTaskId();
        }
      }
));
      final List<TaskRunnerWorkItem> waitingTasks=Lists.newArrayList();
      for (      final Task task : activeTasks) {
        if (!runnersKnownTasks.contains(task.getId())) {
          waitingTasks.add(new TaskRunnerWorkItem(task.getId(),SettableFuture.<TaskStatus>create(),new DateTime(0),new DateTime(0)){
            @Override public TaskLocation getLocation(){
              return TaskLocation.unknown();
            }
          }
);
        }
      }
      return waitingTasks;
    }
  }
);
}
