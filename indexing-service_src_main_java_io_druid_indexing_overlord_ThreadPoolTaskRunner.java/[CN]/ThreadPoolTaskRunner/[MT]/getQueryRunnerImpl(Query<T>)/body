{
  QueryRunner<T> queryRunner=null;
  String queryDataSource;
  try {
    queryDataSource=((TableDataSource)query.getDataSource()).getName();
  }
 catch (  ClassCastException e) {
    throw new IllegalArgumentException("Subqueries are not welcome here");
  }
  for (  final ThreadPoolTaskRunnerWorkItem taskRunnerWorkItem : ImmutableList.copyOf(runningItems)) {
    final Task task=taskRunnerWorkItem.getTask();
    if (task.getDataSource().equals(queryDataSource)) {
      final QueryRunner<T> taskQueryRunner=task.getQueryRunner(query);
      if (taskQueryRunner != null) {
        if (queryRunner == null) {
          queryRunner=taskQueryRunner;
        }
 else {
          log.makeAlert("Found too many query runners for datasource").addData("dataSource",queryDataSource).emit();
        }
      }
    }
  }
  return queryRunner == null ? new NoopQueryRunner<T>() : queryRunner;
}
