{
  try {
    long maxDirectMemory=VMUtils.getMaxDirectMemory();
    final long memoryNeeded=(long)config.intermediateComputeSizeBytes() * (config.getNumThreads() + 1);
    if (maxDirectMemory < memoryNeeded) {
      throw new ProvisionException(String.format("Not enough direct memory.  Please adjust -XX:MaxDirectMemorySize, druid.processing.buffer.sizeBytes, or druid.processing.numThreads: " + "maxDirectMemory[%,d], memoryNeeded[%,d] = druid.processing.buffer.sizeBytes[%,d] * ( druid.processing.numThreads[%,d] + 1 )",maxDirectMemory,memoryNeeded,config.intermediateComputeSizeBytes(),config.getNumThreads()));
    }
  }
 catch (  UnsupportedOperationException e) {
    log.info(e.getMessage());
  }
catch (  RuntimeException e) {
    log.warn(e,e.getMessage());
  }
  return new OffheapBufferPool(config.intermediateComputeSizeBytes());
}
