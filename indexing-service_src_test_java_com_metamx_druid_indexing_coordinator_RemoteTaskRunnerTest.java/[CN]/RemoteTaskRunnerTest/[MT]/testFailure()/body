{
  doSetup();
  ListenableFuture<TaskStatus> future=remoteTaskRunner.run(makeTask(TaskStatus.running("task")));
  final String taskStatus=joiner.join(statusPath,"task");
  Stopwatch stopwatch=new Stopwatch();
  stopwatch.start();
  while (cf.checkExists().forPath(taskStatus) == null) {
    Thread.sleep(100);
    if (stopwatch.elapsed(TimeUnit.MILLISECONDS) > 1000) {
      throw new ISE("Cannot find running task");
    }
  }
  Assert.assertTrue(remoteTaskRunner.getRunningTasks().iterator().next().getTask().getId().equals("task"));
  cf.delete().forPath(taskStatus);
  TaskStatus status=future.get();
  Assert.assertEquals(status.getStatusCode(),TaskStatus.Status.FAILED);
}
