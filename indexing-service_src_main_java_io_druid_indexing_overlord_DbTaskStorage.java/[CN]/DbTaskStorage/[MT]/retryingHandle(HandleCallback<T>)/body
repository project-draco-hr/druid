{
  final Callable<T> call=new Callable<T>(){
    @Override public T call() throws Exception {
      return dbi.withHandle(callback);
    }
  }
;
  final Predicate<Throwable> shouldRetry=new Predicate<Throwable>(){
    @Override public boolean apply(    Throwable e){
      return shouldRetryException(e);
    }
  }
;
  final int maxTries=10;
  try {
    return RetryUtils.retry(call,shouldRetry,maxTries);
  }
 catch (  RuntimeException e) {
    throw Throwables.propagate(e);
  }
catch (  Exception e) {
    throw new CallbackFailedException(e);
  }
}
