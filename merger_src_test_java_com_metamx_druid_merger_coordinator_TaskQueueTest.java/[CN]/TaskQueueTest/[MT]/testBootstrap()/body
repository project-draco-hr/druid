{
  final TaskStorage storage=new LocalTaskStorage();
  storage.insert(newTask("T1","G1","bar",new Interval("2011-01-01/P1D")),TaskStatus.running("T1"));
  storage.insert(newTask("T2","G2","bar",new Interval("2011-02-01/P1D")),TaskStatus.running("T2"));
  storage.setVersion("T1","1234");
  final TaskQueue tq=newTaskQueueWithStorage(storage);
  final VersionedTaskWrapper vt1=tq.poll();
  Assert.assertEquals("vt1 id","T1",vt1.getTask().getId());
  Assert.assertEquals("vt1 version","1234",vt1.getVersion());
  tq.notify(vt1.getTask(),TaskStatus.success("T1",ImmutableSet.<DataSegment>of()));
  tq.stop();
  storage.setStatus("T2",TaskStatus.failure("T2"));
  tq.start();
  Assert.assertNull("null poll",tq.poll());
}
