{
  if (emitter == null) {
    final HttpClientConfig.Builder configBuilder=HttpClientConfig.builder().withNumConnections(1);
    final String emitterTimeoutDuration=props.getProperty("druid.emitter.timeOut");
    if (emitterTimeoutDuration != null) {
      configBuilder.withReadTimeout(new Duration(emitterTimeoutDuration));
    }
    final HttpClient httpClient=HttpClientInit.createClient(configBuilder.build(),lifecycle);
    setEmitter(new ServiceEmitter(PropUtils.getProperty(props,"druid.service"),PropUtils.getProperty(props,"druid.host"),Emitters.create(props,httpClient,jsonMapper,lifecycle)));
  }
  EmittingLogger.registerEmitter(emitter);
}
