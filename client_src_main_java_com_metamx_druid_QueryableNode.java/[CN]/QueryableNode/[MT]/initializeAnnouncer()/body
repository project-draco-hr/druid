{
  if (announcer == null) {
    final Announcer announcer=new Announcer(getCuratorFramework(),Execs.singleThreaded("Announcer-%s"));
    lifecycle.addManagedInstance(announcer);
    final ZkDataSegmentAnnouncerConfig config=getConfigFactory().build(ZkDataSegmentAnnouncerConfig.class);
    final String announcerType=config.getAnnouncerType();
    final DataSegmentAnnouncer dataSegmentAnnouncer;
    if ("curator".equalsIgnoreCase(announcerType)) {
      dataSegmentAnnouncer=new CuratorDataSegmentAnnouncer(getDruidServerMetadata(),getZkPaths(),announcer,getJsonMapper());
    }
 else     if ("batch".equalsIgnoreCase(announcerType)) {
      dataSegmentAnnouncer=new BatchingCuratorDataSegmentAnnouncer(getDruidServerMetadata(),config,announcer,getJsonMapper());
    }
 else     if ("multiple".equalsIgnoreCase(announcerType)) {
      dataSegmentAnnouncer=new MultipleDataSegmentAnnouncerDataSegmentAnnouncer(Arrays.<AbstractDataSegmentAnnouncer>asList(new BatchingCuratorDataSegmentAnnouncer(getDruidServerMetadata(),config,announcer,getJsonMapper()),new CuratorDataSegmentAnnouncer(getDruidServerMetadata(),getZkPaths(),announcer,getJsonMapper())));
    }
 else {
      throw new ISE("Unknown announcer type [%s]",announcerType);
    }
    setAnnouncer(dataSegmentAnnouncer);
    lifecycle.addManagedInstance(getAnnouncer(),Lifecycle.Stage.LAST);
  }
}
