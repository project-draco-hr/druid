{
  final Map<String,List<String>> spatialLookup=Maps.newHashMap();
  final List<String> finalDims=Lists.newArrayList(Iterables.filter(Lists.transform(row.getDimensions(),new Function<String,String>(){
    @Override public String apply(    String input){
      return input.toLowerCase();
    }
  }
),new Predicate<String>(){
    @Override public boolean apply(    String input){
      return !spatialDimNames.contains(input) && !spatialPartialDimNames.contains(input);
    }
  }
));
  InputRow retVal=new InputRow(){
    @Override public List<String> getDimensions(){
      return finalDims;
    }
    @Override public long getTimestampFromEpoch(){
      return row.getTimestampFromEpoch();
    }
    @Override public DateTime getTimestamp(){
      return row.getTimestamp();
    }
    @Override public List<String> getDimension(    String dimension){
      List<String> retVal=spatialLookup.get(dimension);
      return (retVal == null) ? row.getDimension(dimension) : retVal;
    }
    @Override public Object getRaw(    String dimension){
      return row.getRaw(dimension);
    }
    @Override public float getFloatMetric(    String metric){
      try {
        return row.getFloatMetric(metric);
      }
 catch (      ParseException e) {
        throw Throwables.propagate(e);
      }
    }
    @Override public String toString(){
      return row.toString();
    }
    @Override public int compareTo(    Row o){
      return getTimestamp().compareTo(o.getTimestamp());
    }
  }
;
  if (!spatialPartialDimNames.isEmpty()) {
    for (    SpatialDimensionSchema spatialDimension : spatialDimensions) {
      List<String> spatialDimVals=Lists.newArrayList();
      for (      String partialSpatialDim : spatialDimension.getDims()) {
        List<String> dimVals=row.getDimension(partialSpatialDim);
        if (isSpatialDimValsValid(dimVals)) {
          spatialDimVals.addAll(dimVals);
        }
      }
      if (spatialDimVals.size() == spatialPartialDimNames.size()) {
        spatialLookup.put(spatialDimension.getDimName(),Arrays.asList(JOINER.join(spatialDimVals)));
        finalDims.add(spatialDimension.getDimName());
      }
    }
  }
 else {
    for (    String spatialDimName : spatialDimNames) {
      List<String> dimVals=row.getDimension(spatialDimName);
      if (dimVals.size() != 1) {
        throw new ISE("Cannot have a spatial dimension value with size[%d]",dimVals.size());
      }
      if (isJoinedSpatialDimValValid(dimVals.get(0))) {
        spatialLookup.put(spatialDimName,dimVals);
        finalDims.add(spatialDimName);
      }
    }
  }
  return retVal;
}
