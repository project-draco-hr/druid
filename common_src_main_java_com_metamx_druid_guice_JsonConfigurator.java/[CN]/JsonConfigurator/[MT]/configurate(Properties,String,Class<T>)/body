{
  final String propertyBase=propertyPrefix.endsWith(".") ? propertyPrefix : propertyPrefix + ".";
  Map<String,Object> jsonMap=Maps.newHashMap();
  for (  String prop : props.stringPropertyNames()) {
    if (prop.startsWith(propertyBase)) {
      final String propValue=props.getProperty(prop);
      Object value;
      try {
        String modifiedPropValue=propValue;
        if (!(modifiedPropValue.startsWith("[") || modifiedPropValue.startsWith("{"))) {
          modifiedPropValue=String.format("\"%s\"",modifiedPropValue);
        }
        value=jsonMapper.readValue(modifiedPropValue,Object.class);
      }
 catch (      IOException e) {
        log.info(e,"Unable to parse [%s]=[%s] as a json object, using as is.",prop,propValue);
        value=propValue;
      }
      jsonMap.put(prop.substring(propertyBase.length()),value);
    }
  }
  final T config=jsonMapper.convertValue(jsonMap,clazz);
  final Set<ConstraintViolation<T>> violations=validator.validate(config);
  if (!violations.isEmpty()) {
    List<String> messages=Lists.newArrayList();
    for (    ConstraintViolation<T> violation : violations) {
      messages.add(String.format("%s - %s",violation.getPropertyPath().toString(),violation.getMessage()));
    }
    throw new ProvisionException(Iterables.transform(messages,new Function<String,Message>(){
      @Nullable @Override public Message apply(      @Nullable String input){
        return new Message(String.format("%s%s",propertyBase,input));
      }
    }
));
  }
  log.info("Loaded class[%s] as [%s]",clazz,config);
  return config;
}
