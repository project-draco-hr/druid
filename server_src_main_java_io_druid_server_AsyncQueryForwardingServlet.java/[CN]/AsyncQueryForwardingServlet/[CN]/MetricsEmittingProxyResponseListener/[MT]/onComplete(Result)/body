{
  final long requestTime=System.currentTimeMillis() - start;
  try {
    emitter.emit(DruidMetrics.makeQueryTimeMetric(jsonMapper,query,req.getRemoteAddr()).build("query/time",requestTime));
    requestLogger.log(new RequestLogLine(new DateTime(),req.getRemoteAddr(),query,new QueryStats(ImmutableMap.<String,Object>of("query/time",requestTime,"success",true))));
  }
 catch (  Exception e) {
    log.error(e,"Unable to log query [%s]!",query);
  }
  super.onComplete(result);
}
