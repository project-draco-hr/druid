{
  int aggsSize=0;
  for (  AggregatorFactory agg : aggs) {
    aggsSize+=agg.getMaxIntermediateSize();
  }
  final HadoopTuningConfig tuningConfig=config.getSchema().getTuningConfig();
  int bufferSize=aggsSize * tuningConfig.getRowFlushBoundary();
  return new IncrementalIndex(new IncrementalIndexSchema.Builder().withMinTimestamp(theBucket.time.getMillis()).withDimensionsSpec(config.getSchema().getDataSchema().getParser()).withQueryGranularity(config.getSchema().getDataSchema().getGranularitySpec().getQueryGranularity()).withMetrics(aggs).build(),new OffheapBufferPool(bufferSize),tuningConfig.isIngestOffheap());
}
