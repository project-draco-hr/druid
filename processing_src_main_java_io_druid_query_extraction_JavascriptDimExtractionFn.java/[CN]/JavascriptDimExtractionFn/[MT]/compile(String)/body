{
  final ContextFactory contextFactory=ContextFactory.getGlobal();
  final Context context=contextFactory.enterContext();
  context.setOptimizationLevel(9);
  final ScriptableObject scope=context.initStandardObjects();
  final org.mozilla.javascript.Function fn=context.compileFunction(scope,function,"fn",1,null);
  Context.exit();
  return new Function<String,String>(){
    public String apply(    String input){
      Context cx=Context.getCurrentContext();
      if (cx == null) {
        cx=contextFactory.enterContext();
      }
      final Object res=fn.call(cx,scope,scope,new String[]{input});
      return res != null ? Context.toString(res) : null;
    }
  }
;
}
