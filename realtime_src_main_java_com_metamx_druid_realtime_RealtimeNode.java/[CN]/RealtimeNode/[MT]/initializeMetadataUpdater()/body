{
  if (metadataUpdater == null) {
    final MetadataUpdaterConfig metadataUpdaterConfig=getConfigFactory().build(MetadataUpdaterConfig.class);
    final SegmentAnnouncer segmentAnnouncer=new ZkSegmentAnnouncer(metadataUpdaterConfig,getPhoneBook());
    final SegmentPublisher segmentPublisher=new DbSegmentPublisher(getJsonMapper(),metadataUpdaterConfig,new DbConnector(getConfigFactory().build(DbConnectorConfig.class)).getDBI());
    getLifecycle().addManagedInstance(segmentAnnouncer);
    getLifecycle().addManagedInstance(segmentPublisher);
    metadataUpdater=new MetadataUpdater(segmentAnnouncer,segmentPublisher);
  }
}
