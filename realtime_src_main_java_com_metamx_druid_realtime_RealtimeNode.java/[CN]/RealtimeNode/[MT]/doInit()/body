{
  initializeJacksonInjectables();
  final Lifecycle lifecycle=getLifecycle();
  final ServiceEmitter emitter=getEmitter();
  final QueryRunnerFactoryConglomerate conglomerate=getConglomerate();
  final List<Monitor> monitors=getMonitors();
  final List<FireDepartment> departments=getFireDepartments();
  monitors.add(new RealtimeMetricsMonitor(departments));
  final RealtimeManager realtimeManager=new RealtimeManager(departments,conglomerate);
  lifecycle.addManagedInstance(realtimeManager);
  startMonitoring(monitors);
  final Injector injector=Guice.createInjector(new RealtimeServletModule(getJsonMapper()));
  final ServletContextHandler root=new ServletContextHandler(getServer(),"/",ServletContextHandler.SESSIONS);
  root.addEventListener(new GuiceServletConfig(injector));
  root.addFilter(GuiceFilter.class,"/status",null);
  root.addServlet(new ServletHolder(new QueryServlet(getJsonMapper(),getSmileMapper(),realtimeManager,emitter,getRequestLogger())),"/druid/v2/*");
  initialized=true;
}
