{
  initializeView();
  initializeSegmentAnnouncer();
  initializeSegmentPublisher();
  initializeSegmentPusher();
  initializeJacksonInjectables();
  initializeFireDepartments();
  final Lifecycle lifecycle=getLifecycle();
  final ServiceEmitter emitter=getEmitter();
  final QueryRunnerFactoryConglomerate conglomerate=getConglomerate();
  final List<Monitor> monitors=getMonitors();
  monitors.add(new RealtimeMetricsMonitor(fireDepartments));
  final RealtimeManager realtimeManager=new RealtimeManager(fireDepartments,conglomerate);
  lifecycle.addManagedInstance(realtimeManager);
  startMonitoring(monitors);
  final Context root=new Context(getServer(),"/",Context.SESSIONS);
  root.addServlet(new ServletHolder(new StatusServlet()),"/status");
  root.addServlet(new ServletHolder(new QueryServlet(getJsonMapper(),getSmileMapper(),realtimeManager,emitter,getRequestLogger())),"/druid/v2/*");
  initialized=true;
}
