{
  initializeJacksonInjectables();
  final Lifecycle lifecycle=getLifecycle();
  final ServiceEmitter emitter=getEmitter();
  final QueryRunnerFactoryConglomerate conglomerate=getConglomerate();
  final List<Monitor> monitors=getMonitors();
  final List<FireDepartment> departments=getFireDepartments();
  monitors.add(new RealtimeMetricsMonitor(departments));
  final RealtimeManager realtimeManager=new RealtimeManager(departments,conglomerate);
  lifecycle.addManagedInstance(realtimeManager);
  startMonitoring(monitors);
  final Context root=new Context(getServer(),"/",Context.SESSIONS);
  root.addServlet(new ServletHolder(new StatusServlet()),"/status");
  root.addServlet(new ServletHolder(new QueryServlet(getJsonMapper(),getSmileMapper(),realtimeManager,emitter,getRequestLogger())),"/druid/v2/*");
  initialized=true;
}
