{
  if (dataSegmentPusher == null) {
    final Properties props=getProps();
    if (Boolean.parseBoolean(props.getProperty("druid.pusher.local","false"))) {
      dataSegmentPusher=new LocalDataSegmentPusher(getConfigFactory().build(LocalDataSegmentPusherConfig.class),getJsonMapper());
    }
 else {
      final RestS3Service s3Client;
      try {
        s3Client=new RestS3Service(new AWSCredentials(PropUtils.getProperty(props,"com.metamx.aws.accessKey"),PropUtils.getProperty(props,"com.metamx.aws.secretKey")));
      }
 catch (      S3ServiceException e) {
        throw Throwables.propagate(e);
      }
      dataSegmentPusher=new S3DataSegmentPusher(s3Client,getConfigFactory().build(S3DataSegmentPusherConfig.class),getJsonMapper());
    }
  }
}
