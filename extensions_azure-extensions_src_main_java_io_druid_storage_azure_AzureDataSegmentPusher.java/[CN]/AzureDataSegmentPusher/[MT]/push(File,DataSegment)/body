{
  log.info("Uploading [%s] to Azure.",indexFilesDir);
  final int version=SegmentUtils.getVersionFromDir(indexFilesDir);
  final File compressedSegmentData=createCompressedSegmentDataFile(indexFilesDir);
  final File descriptorFile=createSegmentDescriptorFile(jsonMapper,segment);
  final Map<String,String> azurePaths=getAzurePaths(segment);
  try {
    return retryAzureOperation(new Callable<DataSegment>(){
      @Override public DataSegment call() throws Exception {
        return uploadDataSegment(segment,version,compressedSegmentData,descriptorFile,azurePaths);
      }
    }
,azureAccountConfig.getMaxTries());
  }
 catch (  Exception e) {
    throw Throwables.propagate(e);
  }
}
