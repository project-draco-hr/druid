{
  final DataSource dataSource=query.getDataSource();
  if (dataSource instanceof QueryDataSource) {
    GroupByQuery subquery;
    try {
      subquery=(GroupByQuery)((QueryDataSource)dataSource).getQuery().withOverriddenContext(query.getContext());
    }
 catch (    ClassCastException e) {
      throw new UnsupportedOperationException("Subqueries must be of type 'group by'");
    }
    final Sequence<Row> subqueryResult=mergeGroupByResults(subquery.withOverriddenContext(ImmutableMap.<String,Object>of(GroupByQueryHelper.CTX_KEY_SORT_RESULTS,false)),runner,context);
    return strategySelector.strategize(query).processSubqueryResult(subquery,query,subqueryResult);
  }
 else {
    return strategySelector.strategize(query).mergeResults(runner,query,context);
  }
}
