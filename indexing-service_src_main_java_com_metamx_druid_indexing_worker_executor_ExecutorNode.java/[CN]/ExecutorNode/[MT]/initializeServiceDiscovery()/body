{
  final CuratorDiscoveryConfig config=configFactory.build(CuratorDiscoveryConfig.class);
  if (serviceDiscovery == null) {
    this.serviceDiscovery=Initialization.makeServiceDiscoveryClient(getCuratorFramework(),config,lifecycle);
  }
  if (serviceAnnouncer == null) {
    DruidNodeConfig nodeConfig=configFactory.build(DruidNodeConfig.class);
    final ServiceInstanceFactory<Void> instanceFactory=Initialization.makeServiceInstanceFactory(nodeConfig);
    this.serviceAnnouncer=new CuratorServiceAnnouncer(serviceDiscovery,instanceFactory);
  }
  if (coordinatorServiceProvider == null) {
    this.coordinatorServiceProvider=Initialization.makeServiceProvider(workerConfig.getMasterService(),serviceDiscovery,lifecycle);
  }
}
