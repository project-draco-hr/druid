{
  if (useDiscovery) {
    final Lifecycle lifecycle=getLifecycle();
    final CuratorDiscoveryConfig curatorDiscoveryConfig=getConfigFactory().build(CuratorDiscoveryConfig.class);
    final DruidNodeConfig nodeConfig=getConfigFactory().build(DruidNodeConfig.class);
    final CuratorFramework curatorFramework=Initialization.makeCuratorFramework(getConfigFactory().build(CuratorConfig.class),lifecycle);
    final ServiceDiscovery<Void> serviceDiscovery=Initialization.makeServiceDiscoveryClient(curatorFramework,curatorDiscoveryConfig,lifecycle);
    final ServiceAnnouncer serviceAnnouncer=Initialization.makeServiceAnnouncer(nodeConfig,serviceDiscovery);
    Initialization.announceDefaultService(nodeConfig,serviceAnnouncer,lifecycle);
  }
}
