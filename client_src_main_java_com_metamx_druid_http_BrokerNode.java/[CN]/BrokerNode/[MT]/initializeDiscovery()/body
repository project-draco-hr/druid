{
  if (useDiscovery) {
    final Lifecycle lifecycle=getLifecycle();
    final ServiceDiscoveryConfig serviceDiscoveryConfig=getConfigFactory().build(ServiceDiscoveryConfig.class);
    final CuratorFramework curatorFramework=Initialization.makeCuratorFramework(serviceDiscoveryConfig,lifecycle);
    final ServiceDiscovery serviceDiscovery=Initialization.makeServiceDiscoveryClient(curatorFramework,serviceDiscoveryConfig,lifecycle);
    final ServiceAnnouncer serviceAnnouncer=Initialization.makeServiceAnnouncer(serviceDiscoveryConfig,serviceDiscovery);
    Initialization.announceDefaultService(serviceDiscoveryConfig,serviceAnnouncer,lifecycle);
  }
}
