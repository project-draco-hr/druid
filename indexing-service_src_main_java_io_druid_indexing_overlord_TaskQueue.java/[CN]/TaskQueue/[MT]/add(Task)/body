{
  giant.lock();
  try {
    Preconditions.checkState(active,"Queue is not active!");
    Preconditions.checkNotNull(task,"task");
    Preconditions.checkState(tasks.size() < config.getMaxSize(),"Too many tasks (max = %,d)",config.getMaxSize());
    try {
      taskStorage.insert(task,TaskStatus.running(task.getId()));
    }
 catch (    TaskExistsException e) {
      log.warn("Attempt to add task twice: %s",task.getId());
      throw Throwables.propagate(e);
    }
    tasks.add(task);
    managementMayBeNecessary.signalAll();
    return true;
  }
  finally {
    giant.unlock();
  }
}
