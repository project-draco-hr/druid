{
  ZkWorker zkWorker=zkWorkers.get(worker.getHost());
  if (zkWorker != null) {
    try {
      Set<String> tasksPending=Sets.newHashSet(cf.getChildren().forPath(JOINER.join(config.getTaskPath(),worker.getHost())));
      log.info("%s had %d tasks pending",worker.getHost(),tasksPending.size());
      for (      String taskId : tasksPending) {
        TaskRunnerWorkItem taskRunnerWorkItem=pendingTasks.get(taskId);
        if (taskRunnerWorkItem != null) {
          cf.delete().guaranteed().forPath(JOINER.join(config.getTaskPath(),worker.getHost(),taskId));
          retryTask(taskRunnerWorkItem,worker.getHost());
        }
 else {
          log.warn("RemoteTaskRunner has no knowledge of pending task %s",taskId);
        }
      }
      zkWorker.getStatusCache().close();
    }
 catch (    Exception e) {
      throw Throwables.propagate(e);
    }
 finally {
      zkWorkers.remove(worker.getHost());
    }
  }
}
