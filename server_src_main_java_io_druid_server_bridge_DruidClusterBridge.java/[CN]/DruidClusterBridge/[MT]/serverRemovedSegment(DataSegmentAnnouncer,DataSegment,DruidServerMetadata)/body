{
  Integer count=segments.get(segment);
  if (count != null) {
    if (count == 1) {
      dataSegmentAnnouncer.unannounceSegment(segment);
      segments.remove(segment);
    }
 else {
      segments.put(segment,count - 1);
    }
  }
 else {
    log.makeAlert("Trying to remove a segment that was never added?").addData("server",server.getHost()).addData("segmentId",segment.getIdentifier()).emit();
  }
}
