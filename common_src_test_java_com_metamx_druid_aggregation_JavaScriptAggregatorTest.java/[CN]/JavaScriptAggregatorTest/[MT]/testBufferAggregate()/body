{
  final TestFloatMetricSelector selector1=new TestFloatMetricSelector(new float[]{42.12f,9f});
  final TestFloatMetricSelector selector2=new TestFloatMetricSelector(new float[]{2f,3f});
  JavaScriptBufferAggregator agg=new JavaScriptBufferAggregator(Arrays.<FloatMetricSelector>asList(selector1,selector2),JavaScriptAggregatorFactory.compileScript(sumLogATimesBPlusTen));
  ByteBuffer buf=ByteBuffer.allocateDirect(32);
  final int position=4;
  agg.init(buf,position);
  double val=10.;
  Assert.assertEquals(val,agg.get(buf,position));
  Assert.assertEquals(val,agg.get(buf,position));
  Assert.assertEquals(val,agg.get(buf,position));
  aggregateBuffer(selector1,selector2,agg,buf,position);
  val+=Math.log(42.12f) * 2f;
  Assert.assertEquals(val,agg.get(buf,position));
  Assert.assertEquals(val,agg.get(buf,position));
  Assert.assertEquals(val,agg.get(buf,position));
  aggregateBuffer(selector1,selector2,agg,buf,position);
  val+=Math.log(9f) * 3f;
  Assert.assertEquals(val,agg.get(buf,position));
  Assert.assertEquals(val,agg.get(buf,position));
  Assert.assertEquals(val,agg.get(buf,position));
}
