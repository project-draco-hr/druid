{
  final TestFloatMetricSelector selector1=new TestFloatMetricSelector(new float[]{42.12f,9f});
  final TestFloatMetricSelector selector2=new TestFloatMetricSelector(new float[]{2f,3f});
  JavaScriptAggregator agg=new JavaScriptAggregator("billy",Arrays.<FloatMetricSelector>asList(selector1,selector2),JavaScriptAggregatorFactory.compileScript(sumLogATimesBPlusTen));
  agg.reset();
  Assert.assertEquals("billy",agg.getName());
  double val=10.;
  Assert.assertEquals(val,agg.get());
  Assert.assertEquals(val,agg.get());
  Assert.assertEquals(val,agg.get());
  aggregate(selector1,selector2,agg);
  val+=Math.log(42.12f) * 2f;
  Assert.assertEquals(val,agg.get());
  Assert.assertEquals(val,agg.get());
  Assert.assertEquals(val,agg.get());
  aggregate(selector1,selector2,agg);
  val+=Math.log(9f) * 3f;
  Assert.assertEquals(val,agg.get());
  Assert.assertEquals(val,agg.get());
  Assert.assertEquals(val,agg.get());
}
