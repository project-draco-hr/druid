{
  final QueryToolChest<T,Query<T>> toolChest=factory.getToolchest();
  return new FinalizeResultsQueryRunner(toolChest.postMergeQueryDecoration(toolChest.mergeResults(toolChest.preMergeQueryDecoration(new QueryRunner<T>(){
    @Override public Sequence<T> run(    Query<T> query,    Map<String,Object> responseContext){
      List<Sequence<T>> sequences=Lists.newArrayList();
      for (      LogicalWrapper segment : toolChest.filterSegments(query,segments)) {
        sequences.add(factory.createRunner(segment.segment).run(query,responseContext));
      }
      return new MergeSequence<>(query.getResultOrdering(),Sequences.simple(sequences));
    }
  }
))),toolChest);
}
