{
  final TopNQueryBuilder builder=new TopNQueryBuilder().dataSource(DATA_SOURCE).dimension(TOP_DIM).metric("imps").threshold(3).intervals(SEG_SPEC).filters(DIM_FILTER).granularity(GRANULARITY).aggregators(AGGS).postAggregators(POST_AGGS).context(CONTEXT);
  QueryRunner runner=new FinalizeResultsQueryRunner(client,new TopNQueryQueryToolChest(new TopNQueryConfig()));
  testQueryCaching(runner,builder.build(),new Interval("2011-01-01/2011-01-02"),makeTopNResults(new DateTime("2011-01-01"),"a",50,5000,"b",50,4999,"c",50,4998),new Interval("2011-01-02/2011-01-03"),makeTopNResults(new DateTime("2011-01-02"),"a",50,4997,"b",50,4996,"c",50,4995),new Interval("2011-01-05/2011-01-10"),makeTopNResults(new DateTime("2011-01-05"),"a",50,4994,"b",50,4993,"c",50,4992,new DateTime("2011-01-06"),"a",50,4991,"b",50,4990,"c",50,4989,new DateTime("2011-01-07"),"a",50,4991,"b",50,4990,"c",50,4989,new DateTime("2011-01-08"),"a",50,4988,"b",50,4987,"c",50,4986,new DateTime("2011-01-09"),"c1",50,4985,"b",50,4984,"c",50,4983),new Interval("2011-01-05/2011-01-10"),makeTopNResults(new DateTime("2011-01-05T01"),"a",50,4994,"b",50,4993,"c",50,4992,new DateTime("2011-01-06T01"),"a",50,4991,"b",50,4990,"c",50,4989,new DateTime("2011-01-07T01"),"a",50,4991,"b",50,4990,"c",50,4989,new DateTime("2011-01-08T01"),"a",50,4988,"b",50,4987,"c",50,4986,new DateTime("2011-01-09T01"),"c2",50,4985,"b",50,4984,"c",50,4983));
  HashMap<String,List> context=new HashMap<String,List>();
  TestHelper.assertExpectedResults(makeRenamedTopNResults(new DateTime("2011-01-01"),"a",50,5000,"b",50,4999,"c",50,4998,new DateTime("2011-01-02"),"a",50,4997,"b",50,4996,"c",50,4995,new DateTime("2011-01-05"),"a",50,4994,"b",50,4993,"c",50,4992,new DateTime("2011-01-05T01"),"a",50,4994,"b",50,4993,"c",50,4992,new DateTime("2011-01-06"),"a",50,4991,"b",50,4990,"c",50,4989,new DateTime("2011-01-06T01"),"a",50,4991,"b",50,4990,"c",50,4989,new DateTime("2011-01-07"),"a",50,4991,"b",50,4990,"c",50,4989,new DateTime("2011-01-07T01"),"a",50,4991,"b",50,4990,"c",50,4989,new DateTime("2011-01-08"),"a",50,4988,"b",50,4987,"c",50,4986,new DateTime("2011-01-08T01"),"a",50,4988,"b",50,4987,"c",50,4986,new DateTime("2011-01-09"),"c1",50,4985,"b",50,4984,"c",50,4983,new DateTime("2011-01-09T01"),"c2",50,4985,"b",50,4984,"c",50,4983),runner.run(builder.intervals("2011-01-01/2011-01-10").metric("imps").aggregators(RENAMED_AGGS).postAggregators(RENAMED_POST_AGGS).build(),context));
}
