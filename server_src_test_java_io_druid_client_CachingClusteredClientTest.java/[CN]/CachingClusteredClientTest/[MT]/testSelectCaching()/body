{
  final Set<String> dimensions=Sets.<String>newHashSet("a");
  final Set<String> metrics=Sets.<String>newHashSet("rows");
  Druids.SelectQueryBuilder builder=Druids.newSelectQueryBuilder().dataSource(DATA_SOURCE).intervals(SEG_SPEC).filters(DIM_FILTER).granularity(GRANULARITY).dimensions(Arrays.asList("a")).metrics(Arrays.asList("rows")).pagingSpec(new PagingSpec(null,3)).context(CONTEXT);
  testQueryCaching(client,builder.build(),new Interval("2011-01-01/2011-01-02"),makeSelectResults(dimensions,metrics,new DateTime("2011-01-01"),ImmutableMap.of("a","b","rows",1)),new Interval("2011-01-02/2011-01-03"),makeSelectResults(dimensions,metrics,new DateTime("2011-01-02"),ImmutableMap.of("a","c","rows",5)),new Interval("2011-01-05/2011-01-10"),makeSelectResults(dimensions,metrics,new DateTime("2011-01-05"),ImmutableMap.of("a","d","rows",5),new DateTime("2011-01-06"),ImmutableMap.of("a","e","rows",6),new DateTime("2011-01-07"),ImmutableMap.of("a","f","rows",7),new DateTime("2011-01-08"),ImmutableMap.of("a","g","rows",8),new DateTime("2011-01-09"),ImmutableMap.of("a","h","rows",9)),new Interval("2011-01-05/2011-01-10"),makeSelectResults(dimensions,metrics,new DateTime("2011-01-05T01"),ImmutableMap.of("a","d","rows",5),new DateTime("2011-01-06T01"),ImmutableMap.of("a","e","rows",6),new DateTime("2011-01-07T01"),ImmutableMap.of("a","f","rows",7),new DateTime("2011-01-08T01"),ImmutableMap.of("a","g","rows",8),new DateTime("2011-01-09T01"),ImmutableMap.of("a","h","rows",9)));
  QueryRunner runner=new FinalizeResultsQueryRunner(client,new SelectQueryQueryToolChest(jsonMapper,QueryRunnerTestHelper.NoopIntervalChunkingQueryRunnerDecorator()));
  HashMap<String,Object> context=new HashMap<String,Object>();
  TestHelper.assertExpectedResults(makeSelectResults(dimensions,metrics,new DateTime("2011-01-01"),ImmutableMap.of("a","b","rows",1),new DateTime("2011-01-02"),ImmutableMap.of("a","c","rows",5),new DateTime("2011-01-05"),ImmutableMap.of("a","d","rows",5),new DateTime("2011-01-05T01"),ImmutableMap.of("a","d","rows",5),new DateTime("2011-01-06"),ImmutableMap.of("a","e","rows",6),new DateTime("2011-01-06T01"),ImmutableMap.of("a","e","rows",6),new DateTime("2011-01-07"),ImmutableMap.of("a","f","rows",7),new DateTime("2011-01-07T01"),ImmutableMap.of("a","f","rows",7),new DateTime("2011-01-08"),ImmutableMap.of("a","g","rows",8),new DateTime("2011-01-08T01"),ImmutableMap.of("a","g","rows",8),new DateTime("2011-01-09"),ImmutableMap.of("a","h","rows",9),new DateTime("2011-01-09T01"),ImmutableMap.of("a","h","rows",9)),runner.run(builder.intervals("2011-01-01/2011-01-10").build(),context));
}
