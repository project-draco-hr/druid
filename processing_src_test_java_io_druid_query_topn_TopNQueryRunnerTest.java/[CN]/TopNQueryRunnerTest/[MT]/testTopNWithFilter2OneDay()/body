{
  TopNQuery query=new TopNQueryBuilder().dataSource(dataSource).granularity(allGran).filters(qualityDimension,"mezzanine").dimension(providerDimension).metric(indexMetric).threshold(4).intervals(new MultipleIntervalSegmentSpec(Arrays.asList(new Interval("2011-04-01T00:00:00.000Z/2011-04-02T00:00:00.000Z")))).aggregators(commonAggregators).postAggregators(Arrays.<PostAggregator>asList(addRowsIndexConstant)).build();
  List<Result<TopNResultValue>> expectedResults=Arrays.asList(new Result<TopNResultValue>(new DateTime("2011-04-01T00:00:00.000Z"),new TopNResultValue(Arrays.<Map<String,Object>>asList(ImmutableMap.<String,Object>of("provider","upfront","rows",1L,"index",new Float(1447.341160).doubleValue(),"addRowsIndexConstant",new Float(1449.341160).doubleValue()),ImmutableMap.<String,Object>of("provider","total_market","rows",1L,"index",new Float(1314.839715).doubleValue(),"addRowsIndexConstant",new Float(1316.839715).doubleValue()),ImmutableMap.<String,Object>of("provider","spot","rows",1L,"index",new Float(109.705815).doubleValue(),"addRowsIndexConstant",new Float(111.705815).doubleValue())))));
  TestHelper.assertExpectedResults(expectedResults,runner.run(query));
}
