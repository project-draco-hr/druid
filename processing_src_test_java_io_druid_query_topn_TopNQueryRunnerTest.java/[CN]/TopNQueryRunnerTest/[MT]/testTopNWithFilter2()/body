{
  TopNQuery query=new TopNQueryBuilder().dataSource(dataSource).granularity(allGran).filters(qualityDimension,"mezzanine").dimension(providerDimension).metric(indexMetric).threshold(4).intervals(firstToThird).aggregators(commonAggregators).postAggregators(Arrays.<PostAggregator>asList(addRowsIndexConstant)).build();
  List<Result<TopNResultValue>> expectedResults=Arrays.asList(new Result<TopNResultValue>(new DateTime("2011-04-01T00:00:00.000Z"),new TopNResultValue(Arrays.<Map<String,Object>>asList(ImmutableMap.<String,Object>of(providerDimension,"upfront","rows",2L,"index",2591.68359375D,"addRowsIndexConstant",2594.68359375D),ImmutableMap.<String,Object>of(providerDimension,"total_market","rows",2L,"index",2508.39599609375D,"addRowsIndexConstant",2511.39599609375D),ImmutableMap.<String,Object>of(providerDimension,"spot","rows",2L,"index",220.63774871826172D,"addRowsIndexConstant",223.63774871826172D)))));
  TestHelper.assertExpectedResults(expectedResults,runner.run(query));
}
