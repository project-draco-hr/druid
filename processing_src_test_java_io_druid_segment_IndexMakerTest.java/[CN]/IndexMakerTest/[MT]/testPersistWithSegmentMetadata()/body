{
  File outDir=Files.createTempDir();
  QueryableIndex index=null;
  try {
    outDir=Files.createTempDir();
    Map<String,Object> segmentMetadata=ImmutableMap.<String,Object>of("key","value");
    index=IndexIO.loadIndex(IndexMaker.persist(toPersist,outDir,segmentMetadata,INDEX_SPEC));
    Assert.assertEquals(segmentMetadata,index.getMetaData());
  }
  finally {
    if (index != null) {
      index.close();
      ;
    }
    if (outDir != null) {
      FileUtils.deleteDirectory(outDir);
    }
  }
}
