{
  final Injector baseInjector=Guice.createInjector(new DruidGuiceExtensions(),new JacksonModule(),new PropertiesModule("runtime.properties"),new ConfigFactoryModule());
  return Guice.createInjector(Iterables.transform(Arrays.asList(modules),new Function<Object,Module>(){
    @Override @SuppressWarnings("unchecked") public Module apply(    @Nullable Object input){
      if (input instanceof Module) {
        baseInjector.injectMembers(input);
        return (Module)input;
      }
      if (input instanceof Class) {
        if (Module.class.isAssignableFrom((Class)input)) {
          return baseInjector.getInstance((Class<? extends Module>)input);
        }
 else {
          throw new ISE("Class[%s] does not implement %s",input.getClass(),Module.class);
        }
      }
      throw new ISE("Unknown module type[%s]",input.getClass());
    }
  }
));
}
