{
  if (taskStorage == null) {
    if (config.getStorageImpl().equals("local")) {
      taskStorage=new HeapMemoryTaskStorage();
    }
 else     if (config.getStorageImpl().equals("db")) {
      final IndexerDbConnectorConfig dbConnectorConfig=getConfigFactory().build(IndexerDbConnectorConfig.class);
      DbConnector.createTaskTable(dbi,dbConnectorConfig.getTaskTable());
      DbConnector.createTaskLogTable(dbi,dbConnectorConfig.getTaskLogTable());
      DbConnector.createTaskLockTable(dbi,dbConnectorConfig.getTaskLockTable());
      taskStorage=new DbTaskStorage(getJsonMapper(),dbConnectorConfig,new DbConnector(dbConnectorConfig).getDBI());
    }
 else {
      throw new ISE("Invalid storage implementation: %s",config.getStorageImpl());
    }
  }
}
