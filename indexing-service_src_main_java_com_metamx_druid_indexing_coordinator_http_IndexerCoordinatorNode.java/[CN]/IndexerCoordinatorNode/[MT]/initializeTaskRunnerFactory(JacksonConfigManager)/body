{
  if (taskRunnerFactory == null) {
    if (config.getRunnerImpl().equals("remote")) {
      taskRunnerFactory=new TaskRunnerFactory(){
        @Override public TaskRunner build(){
          final CuratorFramework curator=getCuratorFramework();
          final RemoteTaskRunnerConfig remoteTaskRunnerConfig=getConfigFactory().build(RemoteTaskRunnerConfig.class);
          return new RemoteTaskRunner(getJsonMapper(),remoteTaskRunnerConfig,curator,new SimplePathChildrenCacheFactory.Builder().withCompressed(remoteTaskRunnerConfig.enableCompression()).build(),configManager.watch(WorkerSetupData.CONFIG_KEY,WorkerSetupData.class),httpClient);
        }
      }
;
    }
 else     if (config.getRunnerImpl().equals("local")) {
      taskRunnerFactory=new TaskRunnerFactory(){
        @Override public TaskRunner build(){
          final ExecutorService runnerExec=Executors.newFixedThreadPool(config.getNumLocalThreads());
          return new ForkingTaskRunner(getConfigFactory().build(ForkingTaskRunnerConfig.class),getProps(),persistentTaskLogs,runnerExec,getJsonMapper());
        }
      }
;
    }
 else {
      throw new ISE("Invalid runner implementation: %s",config.getRunnerImpl());
    }
  }
}
