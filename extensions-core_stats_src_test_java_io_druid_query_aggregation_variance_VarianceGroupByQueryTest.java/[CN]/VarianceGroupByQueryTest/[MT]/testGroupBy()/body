{
  GroupByQuery query=GroupByQuery.builder().setDataSource(QueryRunnerTestHelper.dataSource).setQuerySegmentSpec(QueryRunnerTestHelper.firstToThird).setDimensions(Lists.<DimensionSpec>newArrayList(new DefaultDimensionSpec("quality","alias"))).setAggregatorSpecs(Arrays.asList(VarianceTestHelper.rowsCount,VarianceTestHelper.indexVarianceAggr,new LongSumAggregatorFactory("idx","index"))).setPostAggregatorSpecs(Arrays.<PostAggregator>asList(VarianceTestHelper.stddevOfIndexPostAggr)).setGranularity(QueryRunnerTestHelper.dayGran).build();
  VarianceTestHelper.RowBuilder builder=new VarianceTestHelper.RowBuilder(new String[]{"alias","rows","idx","index_stddev","index_var"});
  List<Row> expectedResults=builder.add("2011-04-01","automotive",1L,135L,0d,0d).add("2011-04-01","business",1L,118L,0d,0d).add("2011-04-01","entertainment",1L,158L,0d,0d).add("2011-04-01","health",1L,120L,0d,0d).add("2011-04-01","mezzanine",3L,2870L,737.0179286322613d,543195.4271253889d).add("2011-04-01","news",1L,121L,0d,0d).add("2011-04-01","premium",3L,2900L,726.6322593583996d,527994.4403402924d).add("2011-04-01","technology",1L,78L,0d,0d).add("2011-04-01","travel",1L,119L,0d,0d).add("2011-04-02","automotive",1L,147L,0d,0d).add("2011-04-02","business",1L,112L,0d,0d).add("2011-04-02","entertainment",1L,166L,0d,0d).add("2011-04-02","health",1L,113L,0d,0d).add("2011-04-02","mezzanine",3L,2447L,611.3420766546617d,373739.13468843425d).add("2011-04-02","news",1L,114L,0d,0d).add("2011-04-02","premium",3L,2505L,621.3898134843073d,386125.30030206224d).add("2011-04-02","technology",1L,97L,0d,0d).add("2011-04-02","travel",1L,126L,0d,0d).build();
  Iterable<Row> results=GroupByQueryRunnerTestHelper.runQuery(factory,runner,query);
  TestHelper.assertExpectedObjects(expectedResults,results,"");
}
