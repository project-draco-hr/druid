{
  final FirehoseFactory firehoseFactory=ingestionSchema.getIOConfig().getFirehoseFactory();
  final GranularitySpec granularitySpec=ingestionSchema.getDataSchema().getGranularitySpec();
  SortedSet<Interval> retVal=Sets.newTreeSet(Comparators.intervalsByStartThenEnd());
  try (Firehose firehose=firehoseFactory.connect(ingestionSchema.getDataSchema().getParser())){
    while (firehose.hasMore()) {
      final InputRow inputRow=firehose.nextRow();
      Interval interval=granularitySpec.getSegmentGranularity().bucket(new DateTime(inputRow.getTimestampFromEpoch()));
      retVal.add(interval);
    }
  }
   return retVal;
}
