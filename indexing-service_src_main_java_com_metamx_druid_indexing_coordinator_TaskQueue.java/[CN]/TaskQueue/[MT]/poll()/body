{
  giant.lock();
  try {
    for (    final Task task : queue) {
      if (task.getImplicitLockInterval().isPresent()) {
        final Optional<TaskLock> maybeLock=taskLockbox.tryLock(task,task.getImplicitLockInterval().get());
        if (maybeLock.isPresent()) {
          log.info("Task claimed with fixed interval lock: %s",task.getId());
          queue.remove(task);
          return task;
        }
      }
 else {
        log.info("Task claimed with no fixed interval lock: %s",task.getId());
        queue.remove(task);
        return task;
      }
    }
    return null;
  }
  finally {
    giant.unlock();
  }
}
