{
  giant.lock();
  try {
    Preconditions.checkState(active,"Queue is not active!");
    try {
      taskStorage.insert(task,TaskStatus.running(task.getId()));
    }
 catch (    TaskExistsException e) {
      log.warn("Attempt to add task twice: %s",task.getId());
      throw Throwables.propagate(e);
    }
    queue.add(task);
    workMayBeAvailable.signalAll();
    if (task.getImplicitLockInterval().isPresent()) {
      taskLockbox.tryLock(task,task.getImplicitLockInterval().get());
    }
    return true;
  }
  finally {
    giant.unlock();
  }
}
