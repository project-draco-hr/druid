{
  try {
    LZ4Transcoder transcoder=new LZ4Transcoder(config.getMaxObjectSize());
    transcoder.setCompressionThreshold(0);
    OperationQueueFactory opQueueFactory;
    long maxQueueBytes=config.getMaxOperationQueueSize();
    if (maxQueueBytes > 0) {
      opQueueFactory=new MemcachedOperationQueueFactory(maxQueueBytes);
    }
 else {
      opQueueFactory=new LinkedOperationQueueFactory();
    }
    return new MemcachedCache(new MemcachedClient(new MemcachedCustomConnectionFactoryBuilder().setKetamaNodeRepetitions(1000).setHashAlg(MURMUR3_128).setProtocol(ConnectionFactoryBuilder.Protocol.BINARY).setLocatorType(ConnectionFactoryBuilder.Locator.CONSISTENT).setDaemon(true).setFailureMode(FailureMode.Cancel).setTranscoder(transcoder).setShouldOptimize(true).setOpQueueMaxBlockTime(config.getTimeout()).setOpTimeout(config.getTimeout()).setReadBufferSize(config.getReadBufferSize()).setOpQueueFactory(opQueueFactory).build(),AddrUtil.getAddresses(config.getHosts())),config);
  }
 catch (  IOException e) {
    throw Throwables.propagate(e);
  }
}
