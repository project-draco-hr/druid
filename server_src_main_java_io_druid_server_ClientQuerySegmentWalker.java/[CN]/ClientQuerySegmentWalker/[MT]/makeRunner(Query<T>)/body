{
  final QueryToolChest<T,Query<T>> toolChest=warehouse.getToolChest(query);
  final FinalizeResultsQueryRunner<T> baseRunner=new FinalizeResultsQueryRunner<T>(toolChest.postMergeQueryDecoration(toolChest.mergeResults(new UnionQueryRunner<T>(new MetricsEmittingQueryRunner<T>(emitter,new Function<Query<T>,ServiceMetricEvent.Builder>(){
    @Override public ServiceMetricEvent.Builder apply(    @Nullable Query<T> input){
      return toolChest.makeMetricBuilder(query);
    }
  }
,toolChest.preMergeQueryDecoration(baseClient)).withWaitMeasuredFromNow(),toolChest))),toolChest);
  final Map<String,Object> context=query.getContext();
  PostProcessingOperator<T> postProcessing=null;
  if (context != null) {
    postProcessing=objectMapper.convertValue(context.get("postProcessing"),new TypeReference<PostProcessingOperator<T>>(){
    }
);
  }
  return postProcessing != null ? postProcessing.postProcess(baseRunner) : baseRunner;
}
