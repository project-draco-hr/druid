{
  final QueryToolChest<T,Query<T>> toolChest=warehouse.getToolChest(query);
  final FinalizeResultsQueryRunner<T> baseRunner=new FinalizeResultsQueryRunner<T>(toolChest.postMergeQueryDecoration(toolChest.mergeResults(new UnionQueryRunner<T>(new MetricsEmittingQueryRunner<T>(emitter,new Function<Query<T>,ServiceMetricEvent.Builder>(){
    @Override public ServiceMetricEvent.Builder apply(    @Nullable Query<T> input){
      return toolChest.makeMetricBuilder(query);
    }
  }
,toolChest.preMergeQueryDecoration(new RetryQueryRunner<T>(baseClient,toolChest,retryConfig))).withWaitMeasuredFromNow(),toolChest))),toolChest);
  final PostProcessingOperator<T> postProcessing=objectMapper.convertValue(query.getContext().get("postProcessing"),new TypeReference<PostProcessingOperator<T>>(){
  }
);
  return postProcessing != null ? postProcessing.postProcess(baseRunner) : baseRunner;
}
