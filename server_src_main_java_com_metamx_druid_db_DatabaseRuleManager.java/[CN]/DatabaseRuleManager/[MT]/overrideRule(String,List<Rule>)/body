{
synchronized (lock) {
    try {
      dbi.withHandle(new HandleCallback<Void>(){
        @Override public Void withHandle(        Handle handle) throws Exception {
          handle.createStatement(String.format("INSERT INTO %s (id, dataSource, ruleVersion, payload) VALUES (:id, :dataSource, :ruleVersion, :payload)",config.getRuleTable())).bind("id",String.format("%s_%s",dataSource,config.getRuleVersion())).bind("dataSource",dataSource).bind("ruleVersion",config.getRuleVersion()).bind("payload",jsonMapper.writeValueAsString(newRules)).execute();
          return null;
        }
      }
);
      ConcurrentHashMap<String,List<Rule>> existingRules=rules.get();
      if (existingRules == null) {
        existingRules=new ConcurrentHashMap<String,List<Rule>>();
      }
      existingRules.put(dataSource,newRules);
    }
 catch (    Exception e) {
      log.error(e,String.format("Exception while overriding rule for %s",dataSource));
      return false;
    }
  }
  return true;
}
