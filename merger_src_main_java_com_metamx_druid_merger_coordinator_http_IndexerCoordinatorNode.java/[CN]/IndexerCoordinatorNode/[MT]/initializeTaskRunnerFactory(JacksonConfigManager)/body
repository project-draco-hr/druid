{
  if (taskRunnerFactory == null) {
    if (config.getRunnerImpl().equals("remote")) {
      taskRunnerFactory=new TaskRunnerFactory(){
        @Override public TaskRunner build(){
          final ScheduledExecutorService retryScheduledExec=Executors.newScheduledThreadPool(1,new ThreadFactoryBuilder().setDaemon(true).setNameFormat("RemoteRunnerRetryExec--%d").build());
          RemoteTaskRunner remoteTaskRunner=new RemoteTaskRunner(getJsonMapper(),configFactory.build(RemoteTaskRunnerConfig.class),curatorFramework,new PathChildrenCache(curatorFramework,indexerZkConfig.getAnnouncementPath(),true),retryScheduledExec,new RetryPolicyFactory(configFactory.buildWithReplacements(RetryPolicyConfig.class,ImmutableMap.of("base_path","druid.indexing"))),configManager.watch(WorkerSetupData.CONFIG_KEY,WorkerSetupData.class),HttpClientInit.createClient(HttpClientConfig.builder().withNumConnections(1).build(),lifecycle));
          return remoteTaskRunner;
        }
      }
;
    }
 else     if (config.getRunnerImpl().equals("local")) {
      taskRunnerFactory=new TaskRunnerFactory(){
        @Override public TaskRunner build(){
          final ExecutorService runnerExec=Executors.newFixedThreadPool(config.getNumLocalThreads());
          return new ForkingTaskRunner(configFactory.build(ForkingTaskRunnerConfig.class),runnerExec,getJsonMapper());
        }
      }
;
    }
 else {
      throw new ISE("Invalid runner implementation: %s",config.getRunnerImpl());
    }
  }
}
