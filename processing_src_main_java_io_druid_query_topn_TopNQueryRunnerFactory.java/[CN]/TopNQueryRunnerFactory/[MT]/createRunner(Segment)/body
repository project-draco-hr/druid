{
  final TopNQueryEngine queryEngine=new TopNQueryEngine(computationBufferPool);
  return new QueryRunner<Result<TopNResultValue>>(){
    @Override public Sequence<Result<TopNResultValue>> run(    Query<Result<TopNResultValue>> input){
      if (!(input instanceof TopNQuery)) {
        throw new ISE("Got a [%s] which isn't a %s",input.getClass(),TopNQuery.class);
      }
      final TopNQuery legacyQuery=(TopNQuery)input;
      return new BaseSequence<Result<TopNResultValue>,Iterator<Result<TopNResultValue>>>(new BaseSequence.IteratorMaker<Result<TopNResultValue>,Iterator<Result<TopNResultValue>>>(){
        @Override public Iterator<Result<TopNResultValue>> make(){
          return queryEngine.query(legacyQuery,segment.asStorageAdapter()).iterator();
        }
        @Override public void cleanup(        Iterator<Result<TopNResultValue>> toClean){
        }
      }
);
    }
  }
;
}
