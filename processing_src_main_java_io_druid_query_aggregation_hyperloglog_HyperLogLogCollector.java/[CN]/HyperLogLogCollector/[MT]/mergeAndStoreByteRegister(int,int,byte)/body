{
  if (byteToAdd == 0) {
    return 0;
  }
  byte currVal=storageBuffer.get(position);
  int upperNibble=currVal & 0xf0;
  int lowerNibble=currVal & 0x0f;
  int otherUpper=(byteToAdd & 0xf0) - (offsetDiff << bitsPerBucket);
  int otherLower=(byteToAdd & 0x0f) - offsetDiff;
  final int newUpper=Math.max(upperNibble,otherUpper);
  final int newLower=Math.max(lowerNibble,otherLower);
  int numNoLongerZero=0;
  if (upperNibble == 0 && newUpper > 0) {
    ++numNoLongerZero;
  }
  if (lowerNibble == 0 && newLower > 0) {
    ++numNoLongerZero;
  }
  storageBuffer.put(position,(byte)((newUpper | newLower) & 0xff));
  return numNoLongerZero;
}
