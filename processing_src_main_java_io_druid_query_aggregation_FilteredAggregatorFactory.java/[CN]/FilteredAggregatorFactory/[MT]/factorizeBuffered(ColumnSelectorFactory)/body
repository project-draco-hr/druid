{
  final BufferAggregator aggregator=delegate.factorizeBuffered(metricFactory);
  SelectorDimFilter selector=getSelector(filter);
  final DimensionSelector dimensionSelector=metricFactory.makeDimensionSelector(selector.getDimension());
  if (dimensionSelector == null) {
    if (filter instanceof NotDimFilter) {
      return aggregator;
    }
 else {
      return Aggregators.noopBufferAggregator();
    }
  }
  return new FilteredBufferAggregator(dimensionSelector,makeFilterPredicate(filter,dimensionSelector,selector.getValue()),aggregator);
}
