{
  final Aggregator aggregator=delegate.factorize(metricFactory);
  SelectorDimFilter selector=getSelector(filter);
  final DimensionSelector dimensionSelector=metricFactory.makeDimensionSelector(selector.getDimension());
  if (dimensionSelector == null) {
    if (filter instanceof NotDimFilter) {
      return aggregator;
    }
 else {
      return Aggregators.noopAggregator();
    }
  }
  return new FilteredAggregator(dimensionSelector,makeFilterPredicate(filter,dimensionSelector,selector.getValue()),aggregator);
}
