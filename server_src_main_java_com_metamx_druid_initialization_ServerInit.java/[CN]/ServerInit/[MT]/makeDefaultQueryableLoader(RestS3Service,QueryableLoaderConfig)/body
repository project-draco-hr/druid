{
  DelegatingSegmentLoader delegateLoader=new DelegatingSegmentLoader();
  final S3SegmentPuller segmentGetter=new S3SegmentPuller(s3Client);
  final QueryableIndexFactory factory;
  if ("mmap".equals(config.getQueryableFactoryType())) {
    factory=new MMappedQueryableIndexFactory();
  }
 else {
    throw new ISE("Unknown queryableFactoryType[%s]",config.getQueryableFactoryType());
  }
  SingleSegmentLoader segmentLoader=new SingleSegmentLoader(segmentGetter,factory,config.getCacheDirectory());
  delegateLoader.setLoaderTypes(ImmutableMap.<String,SegmentLoader>builder().put("s3",segmentLoader).put("s3_zip",segmentLoader).build());
  return delegateLoader;
}
