{
  DelegatingSegmentLoader delegateLoader=new DelegatingSegmentLoader();
  final S3SegmentPuller segmentGetter=new S3SegmentPuller(s3Client,config);
  final S3ZippedSegmentPuller zippedGetter=new S3ZippedSegmentPuller(s3Client,config);
  final QueryableIndexFactory factory;
  if ("mmap".equals(config.getQueryableFactoryType())) {
    factory=new MMappedQueryableIndexFactory();
  }
 else {
    throw new ISE("Unknown queryableFactoryType[%s]",config.getQueryableFactoryType());
  }
  delegateLoader.setLoaderTypes(ImmutableMap.<String,SegmentLoader>builder().put("s3",new SingleSegmentLoader(segmentGetter,factory)).put("s3_zip",new SingleSegmentLoader(zippedGetter,factory)).build());
  return delegateLoader;
}
