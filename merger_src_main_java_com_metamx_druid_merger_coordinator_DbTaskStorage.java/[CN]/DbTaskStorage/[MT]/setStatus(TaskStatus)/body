{
  Preconditions.checkNotNull(status,"status");
  log.info("Updating task %s to status: %s",status.getId(),status);
  int updated=dbi.withHandle(new HandleCallback<Integer>(){
    @Override public Integer withHandle(    Handle handle) throws Exception {
      return handle.createStatement(String.format("UPDATE %s SET status_code = :status_code, status_payload = :status_payload WHERE id = :id AND status_code = :old_status_code",dbConnectorConfig.getTaskTable())).bind("id",status.getId()).bind("status_code",status.getStatusCode().toString()).bind("old_status_code",TaskStatus.Status.RUNNING.toString()).bind("status_payload",jsonMapper.writeValueAsString(status)).execute();
    }
  }
);
  if (updated != 1) {
    throw new IllegalStateException(String.format("Running task not found: %s",status.getId()));
  }
}
