{
  Preconditions.checkNotNull(status,"status");
  log.info("Updating task %s to status: %s",status.getId(),status);
  int updated=dbi.withHandle(new HandleCallback<Integer>(){
    @Override public Integer withHandle(    Handle handle) throws Exception {
      return handle.createStatement(String.format("UPDATE %s SET active = :active, status_payload = :status_payload WHERE id = :id AND active = 1",dbConnectorConfig.getTaskTable())).bind("id",status.getId()).bind("active",status.isRunnable() ? 1 : 0).bind("status_payload",jsonMapper.writeValueAsString(status)).execute();
    }
  }
);
  if (updated != 1) {
    throw new IllegalStateException(String.format("Active task not found: %s",status.getId()));
  }
}
