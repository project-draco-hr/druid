{
  final File taskFile=config.getTaskFile();
  final File statusFile=config.getStatusFile();
  final InputStream parentStream=config.getParentStream();
  final Task task;
  try {
    task=jsonMapper.readValue(taskFile,Task.class);
    log.info("Running with task: %s",jsonMapper.writerWithDefaultPrettyPrinter().writeValueAsString(task));
  }
 catch (  IOException e) {
    throw Throwables.propagate(e);
  }
  parentMonitorExec.submit(new Runnable(){
    @Override public void run(){
      try {
        while (parentStream.read() != -1) {
        }
      }
 catch (      Exception e) {
        log.error(e,"Failed to read from stdin");
      }
      log.info("Triggering JVM shutdown.");
      System.exit(2);
    }
  }
);
  statusFuture=Futures.transform(taskRunner.run(task),new Function<TaskStatus,TaskStatus>(){
    @Override public TaskStatus apply(    TaskStatus taskStatus){
      try {
        log.info("Task completed with status: %s",jsonMapper.writerWithDefaultPrettyPrinter().writeValueAsString(taskStatus));
        statusFile.getParentFile().mkdirs();
        jsonMapper.writeValue(statusFile,taskStatus);
        return taskStatus;
      }
 catch (      Exception e) {
        throw Throwables.propagate(e);
      }
    }
  }
);
}
