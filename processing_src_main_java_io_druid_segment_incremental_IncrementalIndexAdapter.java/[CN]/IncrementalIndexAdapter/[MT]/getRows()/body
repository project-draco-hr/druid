{
  return FunctionalIterable.create(index.getFacts().entrySet()).transform(new Function<Map.Entry<IncrementalIndex.TimeAndDims,Integer>,Rowboat>(){
    int count=0;
    @Override public Rowboat apply(    @Nullable Map.Entry<IncrementalIndex.TimeAndDims,Integer> input){
      final IncrementalIndex.TimeAndDims timeAndDims=input.getKey();
      final int[][] dimValueIndexes=timeAndDims.getDims();
      final int rowOffset=input.getValue();
      int[][] dims=new int[dimValueIndexes.length][];
      for (      String dimension : index.getDimensions()) {
        int dimIndex=index.getDimensionIndex(dimension);
        final IncrementalIndex.DimDim dimDim=index.getDimension(dimension);
        dimDim.sort();
        if (dimIndex >= dimValueIndexes.length || dimValueIndexes[dimIndex] == null) {
          continue;
        }
        dims[dimIndex]=new int[dimValueIndexes[dimIndex].length];
        if (dimIndex >= dims.length || dims[dimIndex] == null) {
          continue;
        }
        String[] dimValues=index.getDimValues(dimDim,dimValueIndexes[dimIndex]);
        for (int i=0; i < dimValues.length; ++i) {
          dims[dimIndex][i]=dimDim.getSortedId(dimValues[i]);
        }
      }
      Object[] metrics=new Object[index.getMetricAggs().length];
      for (int i=0; i < metrics.length; i++) {
        metrics[i]=index.getAggregator(i).get(index.getMetricBuffer(),index.getMetricPosition(rowOffset,i));
      }
      return new Rowboat(timeAndDims.getTimestamp(),dims,metrics,count++);
    }
  }
);
}
