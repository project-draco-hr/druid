{
  final IncrementalIndex toPersist=new IncrementalIndex(0L,QueryGranularity.NONE,new AggregatorFactory[]{});
  final File tmpDir=Files.createTempDir();
  try {
    toPersist.add(new MapBasedInputRow(1L,ImmutableList.of("dim1","dim2"),ImmutableMap.<String,Object>of("dim1",ImmutableList.of(),"dim2","foo")));
    final QueryableIndex merged=IndexIO.loadIndex(IndexMerger.persist(toPersist,tmpDir));
    Assert.assertEquals(1,merged.getTimeColumn().getLength());
    Assert.assertEquals(ImmutableList.of("dim1","dim2"),ImmutableList.copyOf(merged.getAvailableDimensions()));
    Assert.assertEquals(null,merged.getColumn("dim1"));
  }
  finally {
    FileUtils.deleteQuietly(tmpDir);
  }
}
