{
  giant.lock();
  try {
    Preconditions.checkState(active,"Queue is not active!");
    Preconditions.checkState(!status.isRunnable(),"status must no longer be runnable");
    Preconditions.checkState(task.getId().equals(status.getId()),"Mismatching task ids[%s/%s]",task.getId(),status.getId());
    TaskStatus actualStatus=status;
    try {
      for (      final Task nextTask : status.getNextTasks()) {
        add(nextTask);
        tryLock(nextTask);
      }
    }
 catch (    Exception e) {
      log.error(e,"Failed to continue task: %s",task.getId());
      actualStatus=TaskStatus.failure(task.getId());
    }
    unlock(task);
    taskStorage.setStatus(task.getId(),actualStatus);
    log.info("Task done: %s",task);
  }
  finally {
    giant.unlock();
  }
}
